# YouTube OAuth - Исправление для продакшена

## Найденная проблема:
На продакшене переменная `REPL_ID` содержит неподставленное значение `${REPL_ID}`, что приводило к неправильному определению среды как Replit вместо продакшена.

## Исправления:

### 1. Улучшенная логика определения среды:
- **ПРИОРИТЕТ 1**: Определение по домену Directus
  - `nplanner.ru` → продакшен URL
  - `roboflow.space` → стейдж URL
- **ПРИОРИТЕТ 2**: Replit среда (только с реальным REPL_ID)
- **ПРИОРИТЕТ 3**: Локальная разработка

### 2. Защита от неподставленных переменных:
```javascript
if (replId && replId !== '${REPL_ID}' && !replId.includes('$')) {
  // Используем только реальные значения REPL_ID
}
```

## Результат:
Теперь система правильно определит продакшен среду по домену `directus.nplanner.ru` и будет использовать корректный redirect URI: `https://smm.nplanner.ru/api/youtube/auth/callback`

## Статус:
✅ **ГОТОВО К ДЕПЛОЮ НА ПРОДАКШЕН**