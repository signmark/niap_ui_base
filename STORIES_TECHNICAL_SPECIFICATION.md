# ТЕХНИЧЕСКОЕ ЗАДАНИЕ: Реализация Stories Editor

## 1. ОБЗОР ЗАДАЧИ
Необходимо реализовать полноценную систему создания, редактирования и сохранения Stories контента с генерацией статических слайдов и сохранением интерактивных элементов в метаданных.

## 2. АРХИТЕКТУРА РЕШЕНИЯ

### 2.1 Frontend Components (React/TypeScript)
- **Stories Editor** - основной редактор с canvas и панелью элементов
- **Stories Sidebar** - панель управления слайдами и настройками
- **Stories Toolbar** - инструменты добавления элементов
- **Stories Canvas** - область предпросмотра и редактирования
- **Stories Element Components** - компоненты для разных типов элементов

### 2.2 Backend Services (Python)
- **Static Slide Generator** - генерация статических изображений слайдов
- **Stories API** - REST API для работы с Stories данными
- **Image Processing** - обработка и оптимизация изображений

## 3. ДЕТАЛЬНЫЕ ТРЕБОВАНИЯ

### 3.1 UI/UX Изменения
- ✅ **ВЫПОЛНЕНО**: Добавлен тип контента "Сторис" в селектор
- ✅ **ВЫПОЛНЕНО**: Скрыто поле текстового контента для типа "story"
- ✅ **ВЫПОЛНЕНО**: Добавлена кнопка открытия Stories Editor

### 3.2 Stories Editor Интерфейс
- **Layout**: Разделение на 3 зоны - Sidebar (слайды), Canvas (предпросмотр), Toolbar (элементы)
- **Responsive Design**: Адаптивный интерфейс для разных размеров экрана
- **Real-time Preview**: Мгновенный предпросмотр изменений

### 3.3 Типы Элементов Stories
1. **Текст** - обычный текст с настройками шрифта, цвета, размера
2. **Фото** - загрузка по URL или файл с интеграцией существующего ImageUploader
3. **AI Фото** - генерация изображений через существующую систему AI
4. **Видео** - загрузка по URL или файл с интеграцией существующего VideoUploader
5. **Опрос** - создание опросов с вариантами ответов
6. **Викторина** - стикер викторины с вопросами
7. **Вопрос** - стикер для сбора вопросов от аудитории

### 3.4 Настройки Слайдов
- **Длительность**: Слайдер от 1 до 15 секунд (по умолчанию 5 сек)
- **Фон**: Цвет, градиент или изображение
- **Переходы**: Анимации между слайдами (базовые)

### 3.5 Управление Слайдами
- **Добавление**: Новые слайды с пустым фоном
- **Удаление**: С подтверждением при наличии контента
- **Дублирование**: Копирование слайда со всеми элементами
- **Переупорядочивание**: Drag & Drop для изменения порядка

## 4. ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ

### 4.1 Структура Данных (TypeScript)
```typescript
interface StoryData {
  slides: StorySlide[];
  totalDuration: number;
  aspectRatio: '9:16' | '1:1' | '16:9';
  preview: string; // URL превью
}

interface StorySlide {
  id: string;
  order: number;
  background: BackgroundConfig;
  elements: StoryElement[];
  duration: number; // 1-15 секунд
}

interface StoryElement {
  id: string;
  type: 'text' | 'image' | 'video' | 'poll' | 'question' | 'quiz';
  position: { x: number; y: number };
  size: { width: number; height: number };
  content: string;
  style: ElementStyle;
  options?: PollOptions | QuizOptions;
}
```

### 4.2 Backend API Endpoints
```python
# Stories CRUD
POST /api/stories/generate-static  # Генерация статических слайдов
POST /api/stories/preview          # Генерация превью
GET /api/stories/{id}/slides       # Получение слайдов
PUT /api/stories/{id}/metadata     # Обновление метаданных

# Image Processing
POST /api/stories/process-image    # Обработка изображений для Stories
POST /api/stories/generate-image   # AI генерация изображений
```

### 4.3 Python Static Generator
```python
class StoriesStaticGenerator:
    def generate_slides(self, story_data: dict) -> List[str]:
        """Генерация статических изображений слайдов"""
        
    def create_slide_image(self, slide: dict) -> str:
        """Создание одного слайда"""
        
    def apply_elements(self, image, elements: List[dict]):
        """Наложение элементов на слайд"""
```

## 5. ИНТЕГРАЦИЯ С СУЩЕСТВУЮЩЕЙ СИСТЕМОЙ

### 5.1 Database Schema
- **Использовать**: Существующую таблицу `campaign_content`
- **Поле**: `metadata` для хранения Stories данных
- **Поле**: `additional_media` для ссылок на статические слайды

### 5.2 Существующие Компоненты
- **ImageUploader**: Переиспользовать для загрузки изображений
- **VideoUploader**: Переиспользовать для загрузки видео
- **AI Image Generation**: Интегрировать с Stories Editor

## 6. ПЛАН РЕАЛИЗАЦИИ

### Этап 1: Frontend Core (2-3 часа)
1. Доработка Stories Editor компонентов
2. Реализация добавления/удаления элементов
3. Настройка сохранения/загрузки данных

### Этап 2: Element Types (2-3 часа)
1. Компоненты для всех типов элементов
2. Интерактивные опросы и викторины
3. Настройки стилей и позиционирования

### Этап 3: Backend Integration (2-3 часа)
1. Python сервис генерации статических слайдов
2. API endpoints для Stories
3. Интеграция с существующими сервисами

### Этап 4: Testing & Polish (1-2 часа)
1. Тестирование всех функций
2. Оптимизация производительности
3. UI/UX полировка

## 7. КРИТЕРИИ ПРИЕМКИ

### 7.1 Функциональные требования
- ✅ Скрытие текстового поля для Stories типа
- ⏳ Работающий Stories Editor со всеми типами элементов
- ⏳ Сохранение/загрузка Stories данных
- ⏳ Генерация статических слайдов
- ⏳ Интеграция с существующими загрузчиками медиа

### 7.2 Технические требования
- Совместимость с существующей архитектурой
- Производительность: генерация слайда < 5 секунд
- Responsive design для мобильных устройств
- Обработка ошибок и валидация данных

---

**СТАТУС**: Ожидает согласования и корректировок

После внесения изменений и подтверждения командой **"Go"** начну реализацию согласно плану.