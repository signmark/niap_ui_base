# Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ SMM Manager

## ğŸ“Š ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

**Ğ¦ĞµĞ»ÑŒ:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞµÑ‚ĞµĞ¹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ· Directus Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ N8N Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸.

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ    â”‚    â”‚      N8N        â”‚    â”‚    Directus     â”‚
â”‚     ÑĞµÑ‚Ğ¸        â”‚â”€â”€â”€â–¶â”‚   Ğ¡Ğ±Ğ¾Ñ€Ñ‰Ğ¸Ğº       â”‚â”€â”€â”€â–¶â”‚   Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…   â”‚
â”‚ (TG, VK, IG)    â”‚    â”‚   Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸     â”‚    â”‚  social_platformsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React App     â”‚â—€â”€â”€â”€â”‚  Analytics API  â”‚â—€â”€â”€â”€â”‚     Backend     â”‚
â”‚  (Frontend)     â”‚    â”‚   (Express)     â”‚    â”‚   (Express)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:
1. **ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸** Ğ¿Ğ¾ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸ÑĞ¼ Ğ·Ğ° 7 Ğ¸ 30 Ğ´Ğ½ĞµĞ¹
2. **Ğ¡Ğ±Ğ¾Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** Ğ¸Ğ· Ğ²ÑĞµÑ… Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸
3. **ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼:** Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ñ‹, Ğ»Ğ°Ğ¹ĞºĞ¸, Ñ€ĞµĞ¿Ğ¾ÑÑ‚Ñ‹, ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸
4. **ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· N8N** webhook Ğ¿Ğ¾ ĞºĞ½Ğ¾Ğ¿ĞºĞµ "ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ"
5. **ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸

### ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸:
- **Telegram:** views, likes, shares, comments
- **VK:** views, likes, shares, comments  
- **Instagram:** views, likes, clicks, shares, comments, engagementRate

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
client/src/
â”œâ”€â”€ pages/analytics/
â”‚   â””â”€â”€ index.tsx                    # Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
â”œâ”€â”€ components/analytics/
â”‚   â”œâ”€â”€ CampaignAnalyticsDashboard.tsx
â”‚   â”œâ”€â”€ AnalyticsStatus.tsx
â”‚   â””â”€â”€ MetricsCards.tsx
â””â”€â”€ lib/
    â””â”€â”€ queryClient.ts               # React Query ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

server/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ analytics-routes.ts          # API Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
â””â”€â”€ services/
    â””â”€â”€ analytics.ts                 # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

shared/
â””â”€â”€ analytics-types.ts               # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
```

## ğŸ”§ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Frontend

### 1. Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

```typescript
// client/src/pages/analytics/index.tsx
import React, { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Eye, Heart, Share, MessageCircle, RefreshCw, Loader2 } from 'lucide-react';
import { CampaignAnalyticsDashboard } from '@/components/analytics/CampaignAnalyticsDashboard';
import { AnalyticsStatus } from '@/components/analytics/AnalyticsStatus';

export default function AnalyticsPage() {
  const [selectedCampaign, setSelectedCampaign] = useState('46868c44-c6a4-4bed-accf-9ad07bba790e');
  const [period, setPeriod] = useState<'7days' | '30days'>('7days');

  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
  const { data: campaigns } = useQuery({
    queryKey: ['/api/campaigns'],
    select: (data) => data?.data || []
  });

  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
  const { data: analyticsData, isLoading, error } = useQuery({
    queryKey: ['/api/analytics', selectedCampaign, period],
    enabled: !!selectedCampaign,
    staleTime: 5 * 60 * 1000, // 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ ĞºÑÑˆ
    select: (data) => data?.data || {}
  });

  return (
    <div className="min-h-screen bg-background">
      <div className="container mx-auto px-4 py-8">
        <div className="flex items-center justify-between mb-8">
          <h1 className="text-3xl font-bold">ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹</h1>
          <AnalyticsStatus campaignId={selectedCampaign} />
        </div>

        {/* Ğ¡ĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€Ñ‹ */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
          <Card>
            <CardHeader>
              <CardTitle>Ğ’Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸</CardTitle>
            </CardHeader>
            <CardContent>
              <Select value={selectedCampaign} onValueChange={setSelectedCampaign}>
                <SelectTrigger>
                  <SelectValue placeholder="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ" />
                </SelectTrigger>
                <SelectContent>
                  {campaigns?.map((campaign: any) => (
                    <SelectItem key={campaign.id} value={campaign.id}>
                      {campaign.name}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>ĞŸĞµÑ€Ğ¸Ğ¾Ğ´</CardTitle>
            </CardHeader>
            <CardContent>
              <Select value={period} onValueChange={(value: '7days' | '30days') => setPeriod(value)}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="7days">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 7 Ğ´Ğ½ĞµĞ¹</SelectItem>
                  <SelectItem value="30days">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 30 Ğ´Ğ½ĞµĞ¹</SelectItem>
                </SelectContent>
              </Select>
            </CardContent>
          </Card>
        </div>

        {/* Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ */}
        {isLoading ? (
          <div className="flex items-center justify-center h-64">
            <Loader2 className="h-8 w-8 animate-spin" />
            <span className="ml-2">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸...</span>
          </div>
        ) : error ? (
          <Card>
            <CardContent className="pt-6">
              <p className="text-destructive">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸: {error.message}</p>
            </CardContent>
          </Card>
        ) : (
          <CampaignAnalyticsDashboard data={analyticsData} />
        )}
      </div>
    </div>
  );
}
```

### 2. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

```typescript
// client/src/components/analytics/CampaignAnalyticsDashboard.tsx
import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Eye, Heart, Share, MessageCircle, TrendingUp } from 'lucide-react';

interface AnalyticsData {
  platforms: Array<{
    name: string;
    views: number;
    likes: number;
    shares: number;
    comments: number;
    posts: number;
  }>;
  totalViews: number;
  totalLikes: number;
  totalShares: number;
  totalComments: number;
}

interface MetricCardProps {
  icon: React.ComponentType<any>;
  label: string;
  value: number;
  className?: string;
}

function MetricCard({ icon: Icon, label, value, className = "" }: MetricCardProps) {
  return (
    <Card className={className}>
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
        <CardTitle className="text-sm font-medium">{label}</CardTitle>
        <Icon className="h-4 w-4 text-muted-foreground" />
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{value.toLocaleString()}</div>
      </CardContent>
    </Card>
  );
}

export function CampaignAnalyticsDashboard({ data }: { data: AnalyticsData }) {
  if (!data || !data.platforms) {
    return (
      <Card>
        <CardContent className="pt-6">
          <p className="text-muted-foreground">ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="space-y-8">
      {/* ĞĞ±Ñ‰Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ */}
      <div>
        <h2 className="text-2xl font-semibold mb-4">ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <MetricCard 
            icon={Eye} 
            label="ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ñ‹" 
            value={data.totalViews || 0} 
          />
          <MetricCard 
            icon={Heart} 
            label="Ğ›Ğ°Ğ¹ĞºĞ¸" 
            value={data.totalLikes || 0} 
          />
          <MetricCard 
            icon={Share} 
            label="Ğ ĞµĞ¿Ğ¾ÑÑ‚Ñ‹" 
            value={data.totalShares || 0} 
          />
          <MetricCard 
            icon={MessageCircle} 
            label="ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸" 
            value={data.totalComments || 0} 
          />
        </div>
      </div>

      {/* Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼ */}
      <div>
        <h2 className="text-2xl font-semibold mb-4">Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {data.platforms?.map((platform) => (
            <Card key={platform.name}>
              <CardHeader>
                <CardTitle className="flex items-center space-x-2">
                  <TrendingUp className="h-5 w-5" />
                  <span>{platform.name}</span>
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-2">
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span className="text-muted-foreground">ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ñ‹:</span>
                    <p className="font-semibold">{platform.views?.toLocaleString() || 0}</p>
                  </div>
                  <div>
                    <span className="text-muted-foreground">Ğ›Ğ°Ğ¹ĞºĞ¸:</span>
                    <p className="font-semibold">{platform.likes?.toLocaleString() || 0}</p>
                  </div>
                  <div>
                    <span className="text-muted-foreground">Ğ ĞµĞ¿Ğ¾ÑÑ‚Ñ‹:</span>
                    <p className="font-semibold">{platform.shares?.toLocaleString() || 0}</p>
                  </div>
                  <div>
                    <span className="text-muted-foreground">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸:</span>
                    <p className="font-semibold">{platform.comments?.toLocaleString() || 0}</p>
                  </div>
                </div>
                <div className="pt-2 border-t">
                  <span className="text-muted-foreground">ĞŸĞ¾ÑÑ‚Ğ¾Ğ²:</span>
                  <p className="font-semibold">{platform.posts || 0}</p>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    </div>
  );
}
```

### 3. ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

```typescript
// client/src/components/analytics/AnalyticsStatus.tsx
import React, { useState } from 'react';
import { Button } from '@/components/ui/button';
import { RefreshCw, Loader2 } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
import { useQueryClient } from '@tanstack/react-query';

export function AnalyticsStatus({ campaignId }: { campaignId: string }) {
  const [isUpdating, setIsUpdating] = useState(false);
  const { toast } = useToast();
  const queryClient = useQueryClient();

  const updateAnalytics = async () => {
    if (!campaignId) {
      toast({
        title: "ĞÑˆĞ¸Ğ±ĞºĞ°",
        description: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸",
        variant: "destructive"
      });
      return;
    }

    setIsUpdating(true);

    try {
      // Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ N8N webhook Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
      const response = await fetch('https://n8n.nplanner.ru/webhook/posts-to-analytics', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          campaignId,
          days: 7,
          timestamp: new Date().toISOString(),
          source: 'smm_manager'
        })
      });

      if (response.ok) {
        toast({
          title: "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾",
          description: "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· N8N..."
        });

        // ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‡ĞµÑ€ĞµĞ· 10 ÑĞµĞºÑƒĞ½Ğ´
        setTimeout(() => {
          queryClient.invalidateQueries({ 
            queryKey: ['/api/analytics', campaignId] 
          });
          
          toast({
            title: "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹",
            description: "ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ±Ñ‹Ğ»Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°"
          });
        }, 10000);
      } else {
        throw new Error(`HTTP ${response.status}`);
      }
    } catch (error) {
      console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸:', error);
      toast({
        title: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ",
        description: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ñ‡ĞµÑ€ĞµĞ· N8N",
        variant: "destructive"
      });
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <Button 
      onClick={updateAnalytics} 
      disabled={isUpdating}
      variant="outline"
    >
      {isUpdating ? (
        <Loader2 className="h-4 w-4 animate-spin mr-2" />
      ) : (
        <RefreshCw className="h-4 w-4 mr-2" />
      )}
      ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ
    </Button>
  );
}
```

## ğŸ”§ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Backend

### 1. API Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

```typescript
// server/api/analytics-routes.ts
import { Router } from 'express';
import { requireAuth } from '../middleware/auth';
import axios from 'axios';

const router = Router();

router.get('/api/analytics', requireAuth, async (req, res) => {
  try {
    const { campaignId, period = '7days' } = req.query;
    
    if (!campaignId) {
      return res.status(400).json({
        success: false,
        error: 'Campaign ID is required'
      });
    }

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    const authToken = req.headers.authorization?.replace('Bearer ', '');
    if (!authToken) {
      return res.status(401).json({
        success: false,
        error: 'Authorization token required'
      });
    }

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ Ğ¸Ğ· Directus
    const directusUrl = process.env.DIRECTUS_URL || 'https://directus.nplanner.ru';
    
    const response = await axios.get(`${directusUrl}/items/campaign_content`, {
      headers: {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json'
      },
      params: {
        filter: JSON.stringify({
          campaign_id: { _eq: campaignId },
          status: { _eq: 'published' }
        }),
        limit: -1 // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
      }
    });

    if (!response.data?.data) {
      return res.json({
        success: true,
        data: {
          platforms: [],
          totalViews: 0,
          totalLikes: 0,
          totalShares: 0,
          totalComments: 0
        }
      });
    }

    // ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
    const analytics = processAnalyticsData(response.data.data, period as string);

    res.json({
      success: true,
      data: analytics
    });

  } catch (error: any) {
    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸:', error);
    res.status(500).json({
      success: false,
      error: error.message || 'Internal server error'
    });
  }
});

function processAnalyticsData(contentItems: any[], period: string) {
  // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ´Ğ°Ñ‚Ñƒ ÑÑ€ĞµĞ·Ğ° Ğ´Ğ»Ñ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - (period === '7days' ? 7 : 30));

  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼
  const platformStats = {
    telegram: { views: 0, likes: 0, shares: 0, comments: 0, posts: 0 },
    vk: { views: 0, likes: 0, shares: 0, comments: 0, posts: 0 },
    instagram: { views: 0, likes: 0, shares: 0, comments: 0, posts: 0 }
  };

  // ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°
  contentItems.forEach(item => {
    if (!item.social_platforms) return;

    // ĞŸĞ°Ñ€ÑĞ¸Ğ¼ social_platforms ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ ÑÑ‚Ñ€Ğ¾ĞºĞ°
    let platforms = item.social_platforms;
    if (typeof platforms === 'string') {
      try {
        platforms = JSON.parse(platforms);
      } catch (e) {
        console.warn(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° social_platforms Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° ${item.id}:`, e);
        return;
      }
    }

    // ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñƒ
    Object.entries(platforms).forEach(([platformName, platformData]: [string, any]) => {
      if (platformData?.status === 'published' && platformData?.analytics) {
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ°Ñ‚Ñƒ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
        const publishedDate = new Date(platformData.publishedAt);
        if (publishedDate >= cutoffDate) {
          const stats = platformStats[platformName as keyof typeof platformStats];
          if (stats) {
            stats.views += platformData.analytics.views || 0;
            stats.likes += platformData.analytics.likes || 0;
            stats.shares += platformData.analytics.shares || 0;
            stats.comments += platformData.analytics.comments || 0;
            stats.posts += 1;
          }
        }
      }
    });
  });

  // Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
  return {
    platforms: [
      { name: 'Telegram', ...platformStats.telegram },
      { name: 'VK', ...platformStats.vk },
      { name: 'Instagram', ...platformStats.instagram }
    ].filter(platform => platform.posts > 0), // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ñ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ¼Ğ¸
    totalViews: Object.values(platformStats).reduce((sum, p) => sum + p.views, 0),
    totalLikes: Object.values(platformStats).reduce((sum, p) => sum + p.likes, 0),
    totalShares: Object.values(platformStats).reduce((sum, p) => sum + p.shares, 0),
    totalComments: Object.values(platformStats).reduce((sum, p) => sum + p.comments, 0)
  };
}

export default router;
```

### 2. Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```typescript
// shared/analytics-types.ts
export interface PlatformAnalytics {
  views: number;
  likes: number;
  shares: number;
  comments: number;
  clicks?: number;
  engagementRate?: number;
  lastUpdated: string;
}

export interface SocialPlatformData {
  status: 'pending' | 'publishing' | 'published' | 'failed';
  platform: string;
  selected?: boolean;
  postId?: string;
  postUrl?: string;
  publishedAt?: string;
  analytics?: PlatformAnalytics;
  error?: string;
}

export interface SocialPlatforms {
  telegram?: SocialPlatformData;
  vk?: SocialPlatformData;
  instagram?: SocialPlatformData;
  facebook?: SocialPlatformData;
}

export interface AnalyticsData {
  platforms: Array<{
    name: string;
    views: number;
    likes: number;
    shares: number;
    comments: number;
    posts: number;
  }>;
  totalViews: number;
  totalLikes: number;
  totalShares: number;
  totalComments: number;
}

export interface AnalyticsAPIResponse {
  success: boolean;
  data?: AnalyticsData;
  error?: string;
}
```

## ğŸŒ N8N Integration

### N8N Webhook Configuration

**URL:** `https://n8n.nplanner.ru/webhook/posts-to-analytics`  
**Method:** POST  
**Content-Type:** application/json

**Payload:**
```json
{
  "campaignId": "46868c44-c6a4-4bed-accf-9ad07bba790e",
  "days": 7,
  "timestamp": "2025-05-22T15:30:00Z",
  "source": "smm_manager"
}
```

### N8N Workflow Logic:
1. **Trigger:** Webhook receives request
2. **Get Content:** Fetch published posts from Directus for campaign
3. **Collect Analytics:** For each post, get fresh data from social APIs
4. **Update Directus:** Save new analytics data to social_platforms field
5. **Response:** Return success status

## ğŸ“Š Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Directus

### campaign_content.social_platforms format:
```json
{
  "telegram": {
    "status": "published",
    "platform": "telegram",
    "postUrl": "https://t.me/c/2302366310/702",
    "publishedAt": "2025-04-08T10:52:19.358Z",
    "analytics": {
      "likes": 0,
      "views": 648,
      "shares": 2,
      "comments": 1,
      "lastUpdated": "2025-05-22T08:00:33.472Z"
    }
  },
  "vk": {
    "status": "published",
    "platform": "vk",
    "postUrl": "https://vk.com/wall-228626989_686",
    "publishedAt": "2025-04-25T13:53:27.791Z",
    "analytics": {
      "likes": 12,
      "views": 755,
      "shares": 5,
      "comments": 3,
      "lastUpdated": "2025-04-25T13:57:43.551Z"
    }
  }
}
```

## âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ°

### Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:
- [ ] ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Directus
- [ ] ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ğ¾ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°Ğ¼ 7/30 Ğ´Ğ½ĞµĞ¹
- [ ] ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ N8N webhook
- [ ] ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ¼
- [ ] Ğ’Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ < 3 ÑĞµĞºÑƒĞ½Ğ´

### UI/UX:
- [ ] Ğ£Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ Ğ¸ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°
- [ ] Ğ§ĞµÑ‚ĞºĞ¾Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼
- [ ] Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸
- [ ] ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

### Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ:
- [ ] API Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- [ ] React Query ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ ĞºÑÑˆĞ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
- [ ] ĞĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
- [ ] N8N webhook Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾

---

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ âœ…  
**Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹:** âœ…  
**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ N8N Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ°:** âœ…