# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Gemini API –Ω–∞ —Å—Ç–µ–π–¥–∂–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ —Å—Ç–µ–π–¥–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–µ –∞–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É:
```
"User location is not supported for the API use."
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∫ Gemini API –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ª–æ–∫–∞—Ü–∏–∏, –º–∏–Ω—É—è –∫–∞–Ω–∞–¥—Å–∫–∏–π SOCKS5 –ø—Ä–æ–∫—Å–∏.

## –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç–µ–π–¥–∂–µ
```bash
export FORCE_GEMINI_PROXY=true
export NODE_ENV=staging
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ–∫—Å–∏-–∫—Ä–µ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞ —Å—Ç–µ–π–¥–∂–µ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
export PROXY_HOST=138.219.123.68
export PROXY_PORT=9710
export PROXY_USERNAME=PGjuJV
export PROXY_PASSWORD=cwZmJ3
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
```bash
pm2 restart smm-app
# –∏–ª–∏
systemctl restart smm-app
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π:
```bash
curl -X POST "https://your-staging-domain.com/api/trend-sentiment/TREND_ID" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```bash
# –ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:
# ‚úÖ "[gemini-proxy] üá®üá¶ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–Ω–∞–¥—Å–∫–∏–π SOCKS5 –ø—Ä–æ–∫—Å–∏"
# ‚ùå "[gemini-proxy] ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ–∫—Å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

tail -f /var/log/smm-app/error.log | grep "gemini-proxy"
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ `server/services/gemini-proxy.ts`:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥—ã**: `isStaging = NODE_ENV === 'staging'`
2. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏**: `forceProxy = FORCE_GEMINI_PROXY === 'true'`
3. **–õ–æ–≥–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏**: `if (isStaging || forceProxy || !isReplit)`

## –í Replit
–í Replit –ø—Ä–æ–∫—Å–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (IP –°–®–ê, –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ Google).

## –ù–∞ —Å—Ç–µ–π–¥–∂–µ/–ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
–ü—Ä–æ–∫—Å–∏ –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Google API.

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vertex AI API:
- –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å —Å `gemini-1.5-flash` –Ω–∞ `gemini-2.5-flash`
- Vertex AI –∏–º–µ–µ—Ç –º–µ–Ω—å—à–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π