#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -z "$TELEGRAM_BOT_TOKEN" ] || [ -z "$TELEGRAM_CHAT_ID" ]; then
  echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_BOT_TOKEN –∏–ª–∏ TELEGRAM_CHAT_ID"
  echo "–¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π."
  echo ""
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç
TEST_FILE="tests/e2e/telegram.spec.ts"
if [ ! -f "$TEST_FILE" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª —Ç–µ—Å—Ç–∞ $TEST_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω"
  exit 1
fi

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞
PARAMS=""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
if [ "$1" == "debug" ]; then
  echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏..."
  PARAMS="--debug"
elif [ "$1" == "headed" ]; then
  echo "üñ•Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –≤ —Ä–µ–∂–∏–º–µ —Å –±—Ä–∞—É–∑–µ—Ä–æ–º..."
  PARAMS="--headed"
elif [ "$1" == "ui" ]; then
  echo "üñºÔ∏è –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º Playwright..."
  PARAMS="--ui"
fi

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram..."
npx playwright test $TEST_FILE $PARAMS

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞
if [ $? -eq 0 ]; then
  echo "‚úÖ –¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
else
  echo "‚ùå –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–∞–º–∏"
fi