# Пошаговая инструкция по созданию бизнес-аккаунта Instagram и получению API доступа

Данное руководство содержит детальные инструкции по созданию бизнес-аккаунта Instagram и настройке приложения для получения API доступа через Facebook Graph API.

## Часть 1: Создание бизнес-аккаунта Instagram

### Шаг 1: Создание личного аккаунта Instagram
1. Скачайте приложение Instagram из App Store или Google Play Store.
2. Откройте приложение и нажмите «Создать новую учетную запись».
3. Введите адрес электронной почты или номер телефона.
4. Создайте имя пользователя и пароль.
5. Заполните свой профиль, добавив фото профиля и информацию о себе.

### Шаг 2: Переключение на профессиональный аккаунт
1. Откройте свой профиль Instagram и нажмите на три горизонтальные линии в правом верхнем углу.
2. Выберите «Настройки и конфиденциальность».
3. Прокрутите вниз и нажмите «Аккаунт».
4. Прокрутите вниз и нажмите «Переключиться на профессиональный аккаунт».
5. Выберите категорию бизнеса, которая лучше всего описывает вашу деятельность.
6. Выберите тип профессионального аккаунта: «Бизнес».
7. (Опционально) Добавьте контактную информацию и нажмите «Далее».
8. Подключите страницу Facebook или создайте новую (обязательный шаг):
   - Если у вас есть страница Facebook, выберите ее из списка.
   - Если у вас нет страницы Facebook, нажмите «Создать новую страницу Facebook».
9. После подключения страницы Facebook, нажмите «Далее».
10. Ознакомьтесь с функциями профессионального аккаунта и нажмите «Готово».

### Шаг 3: Настройка бизнес-аккаунта Instagram
1. Убедитесь, что ваш профиль заполнен полной информацией:
   - Добавьте бизнес-описание в био.
   - Укажите контактную информацию: email, телефон, местоположение.
   - Добавьте ссылку на ваш веб-сайт.
2. Создайте несколько публикаций, чтобы ваш аккаунт выглядел активным.
3. Проверьте доступ к Instagram Insights (аналитике):
   - Перейдите в свой профиль.
   - Нажмите на «Статистика» или «Insights».
   - Убедитесь, что вы видите данные о вашей аудитории и публикациях.

## Часть 2: Создание приложения в Facebook Developer Portal

### Шаг 1: Создание учетной записи разработчика Facebook
1. Перейдите на [Facebook for Developers](https://developers.facebook.com/).
2. Нажмите «Войти» в правом верхнем углу и войдите в свой аккаунт Facebook.
3. Если вы еще не зарегистрированы как разработчик, вам будет предложено создать учетную запись разработчика.
4. Следуйте инструкциям для создания учетной записи разработчика:
   - Подтвердите свой аккаунт Facebook (если требуется).
   - Примите условия использования Facebook для разработчиков.
   - Предоставьте дополнительную информацию, если требуется.

### Шаг 2: Создание приложения Facebook
1. Перейдите на [Facebook for Developers](https://developers.facebook.com/).
2. Нажмите на «Мои приложения» в правом верхнем углу.
3. Нажмите «Создать приложение».
4. Выберите тип приложения: «Бизнес».
5. Заполните информацию о приложении:
   - Название приложения (например, «Мой SMM Менеджер»).
   - Контактная электронная почта.
   - Бизнес-аккаунт (если у вас есть бизнес-аккаунт Facebook, выберите его).
6. Нажмите «Создать приложение».
7. Выполните проверку безопасности, если она требуется.

### Шаг 3: Настройка приложения для Instagram Graph API
1. На панели разработчика вашего приложения нажмите «Добавить продукты».
2. Найдите «Facebook Login» и нажмите «Настроить».
3. В левом меню выберите «Настройки» под «Facebook Login».
4. В поле «Действительные URI для перенаправления OAuth» добавьте URL вашего приложения для обработки OAuth (например, `https://yourdomain.com/auth/facebook/callback`).
5. Сохраните изменения.
6. Вернитесь к списку продуктов и найдите «Instagram Graph API» или «Instagram Basic Display API».
7. Нажмите «Настроить».
8. Следуйте инструкциям по настройке Instagram API.

### Шаг 4: Добавление разрешений и настройка тестового приложения
1. В левом меню перейдите в «Конфигурация приложения» -> «Расширенный доступ».
2. В секции «Разрешения и функции» нажмите «Запросить» для следующих разрешений:
   - `instagram_basic` (базовый доступ к данным Instagram)
   - `instagram_content_publish` (публикация контента)
   - `instagram_manage_comments` (управление комментариями)
   - `instagram_manage_insights` (доступ к аналитике)
   - `pages_show_list` (просмотр списка страниц)
   - `pages_read_engagement` (чтение взаимодействий со страницей)
   - `pages_manage_posts` (управление постами страницы)
3. Для каждого разрешения вам нужно будет заполнить форму, объясняющую:
   - Как ваше приложение использует это разрешение.
   - Где пользователи могут увидеть использование этого разрешения.
   - Загрузить скриншоты, демонстрирующие использование.
4. В левом меню перейдите в «Роли» -> «Тестовые пользователи».
5. Добавьте себя и других тестировщиков как тестовых пользователей.

### Шаг 5: Базовая настройка для тестирования
1. В левом меню перейдите в «Настройки» -> «Основные».
2. Заполните информацию о конфиденциальности:
   - URL Политики конфиденциальности.
   - URL Условий использования.
3. Добавьте иконку приложения и другие обязательные поля.
4. В разделе «Домены приложения» добавьте домены, с которых ваше приложение будет делать запросы.
5. Сохраните изменения.

## Часть 3: Получение токенов доступа для Instagram Graph API

### Шаг 1: Получение токена доступа пользователя Facebook
1. Перейдите на [Facebook Graph API Explorer](https://developers.facebook.com/tools/explorer/).
2. В выпадающем меню справа выберите свое приложение.
3. Нажмите на «Создать токен доступа».
4. Выберите необходимые разрешения:
   - `instagram_basic`
   - `instagram_content_publish`
   - `instagram_manage_comments`
   - `instagram_manage_insights`
   - `pages_show_list`
   - `pages_read_engagement`
   - `pages_manage_posts`
5. Нажмите «Создать токен доступа».
6. Авторизуйте доступ в появившемся окне.
7. Скопируйте полученный токен доступа.

### Шаг 2: Получение токена доступа страницы Facebook
1. Используя токен доступа пользователя, выполните запрос к API для получения списка страниц:
   ```
   GET https://graph.facebook.com/v19.0/me/accounts?access_token={user-access-token}
   ```
2. В ответе API найдите ID вашей страницы Facebook и соответствующий ей токен доступа страницы.
3. Скопируйте токен доступа страницы и ID страницы.

### Шаг 3: Получение ID бизнес-аккаунта Instagram
1. Используя токен доступа страницы, выполните запрос к API для получения связанного аккаунта Instagram:
   ```
   GET https://graph.facebook.com/v19.0/{page-id}/instagram_business_account?access_token={page-access-token}
   ```
2. В ответе API вы получите ID бизнес-аккаунта Instagram.
3. Скопируйте ID бизнес-аккаунта Instagram.

### Шаг 4: Проверка доступа к Instagram Graph API
1. Используя токен доступа страницы и ID бизнес-аккаунта Instagram, сделайте тестовый запрос:
   ```
   GET https://graph.facebook.com/v19.0/{instagram-business-account-id}?fields=name,username,profile_picture_url&access_token={page-access-token}
   ```
2. Если запрос успешен, вы должны получить информацию о вашем бизнес-аккаунте Instagram.

## Часть 4: Публикация контента через Instagram Graph API

### Шаг 1: Создание контейнера для медиа
1. Для публикации изображения необходимо сначала создать контейнер:
   ```
   POST https://graph.facebook.com/v19.0/{instagram-business-account-id}/media?image_url={image-url}&caption={caption}&access_token={page-access-token}
   ```
2. В ответе вы получите ID созданного контейнера медиа.

### Шаг 2: Публикация контента
1. Используя ID контейнера медиа, отправьте запрос на публикацию:
   ```
   POST https://graph.facebook.com/v19.0/{instagram-business-account-id}/media_publish?creation_id={media-container-id}&access_token={page-access-token}
   ```
2. В ответе вы получите ID опубликованного медиа.

### Шаг 3: Получение информации о публикации
1. Используя ID опубликованного медиа, получите информацию о публикации:
   ```
   GET https://graph.facebook.com/v19.0/{media-id}?fields=id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token={page-access-token}
   ```
2. В ответе вы получите детальную информацию о вашей публикации, включая ссылку на нее (permalink).

## Часть 5: Создание долгосрочных токенов доступа

### Шаг 1: Обмен краткосрочного токена на долгосрочный
1. Используя краткосрочный токен доступа пользователя, выполните запрос на получение долгосрочного токена:
   ```
   GET https://graph.facebook.com/v19.0/oauth/access_token?grant_type=fb_exchange_token&client_id={app-id}&client_secret={app-secret}&fb_exchange_token={short-lived-token}
   ```
2. В ответе вы получите долгосрочный токен доступа пользователя, который действует около 60 дней.

### Шаг 2: Получение долгосрочного токена доступа страницы
1. Используя долгосрочный токен доступа пользователя, повторите запрос на получение списка страниц:
   ```
   GET https://graph.facebook.com/v19.0/me/accounts?access_token={long-lived-user-token}
   ```
2. Токены доступа страниц, полученные с помощью долгосрочного токена пользователя, также будут долгосрочными.

### Шаг 3: Хранение и обновление токенов
1. Храните полученные токены в безопасном месте, например, в зашифрованной базе данных.
2. Реализуйте механизм обновления токенов до истечения их срока действия.
3. Настройте оповещения о приближающемся истечении срока действия токенов.

## Часть 6: Прохождение App Review для публичного использования

### Шаг 1: Подготовка к App Review
1. Убедитесь, что ваше приложение полностью функционально и соответствует требованиям Facebook.
2. Подготовьте материалы для проверки:
   - Скриншоты использования каждого разрешения.
   - Видео-демонстрации работы с API.
   - Подробное описание бизнес-кейса для каждого разрешения.

### Шаг 2: Подача заявки на проверку
1. В панели разработчика перейдите в «Конфигурация приложения» -> «Расширенный доступ».
2. Для каждого разрешения, которое вы хотите использовать в публичном режиме, нажмите «Запрос».
3. Заполните все необходимые поля формы проверки.
4. Отправьте заявку на проверку.

### Шаг 3: Отслеживание статуса проверки
1. Регулярно проверяйте статус вашей заявки в панели разработчика.
2. Будьте готовы ответить на дополнительные вопросы от команды проверки Facebook.
3. Внесите необходимые изменения, если они будут запрошены.

### Шаг 4: Запуск в производственный режим
1. После успешного прохождения проверки, переведите свое приложение из режима разработки в режим производства.
2. В панели разработчика перейдите в «Настройки» -> «Основные».
3. Измените статус приложения на «Производственный».
4. Подтвердите изменение статуса.

## Примечания и лучшие практики

### Безопасность
1. Никогда не храните токены доступа в клиентском коде (JavaScript).
2. Используйте безопасные соединения (HTTPS) для всех запросов к API.
3. Реализуйте проверку подлинности для всех эндпоинтов вашего приложения.
4. Регулярно проверяйте и обновляйте токены доступа.

### Ограничения API
1. Instagram Graph API имеет лимиты на количество запросов (rate limits).
2. Для публикации контента существуют ограничения по форматам и размерам медиафайлов.
3. Некоторые функции доступны только для определенных типов аккаунтов.

### Общие рекомендации
1. Тщательно тестируйте функциональность вашего приложения перед запуском.
2. Следите за обновлениями Instagram Graph API и Facebook Graph API.
3. Документируйте все API-вызовы и токены доступа для упрощения отладки.
4. Разработайте механизм обработки ошибок для случаев, когда API недоступен или возвращает ошибки.

## Полезные ресурсы
- [Instagram Graph API Documentation](https://developers.facebook.com/docs/instagram-api)
- [Facebook Graph API Documentation](https://developers.facebook.com/docs/graph-api)
- [Facebook for Developers - Getting Started](https://developers.facebook.com/docs/development/getting-started)
- [Instagram Business Setup Guide](https://developers.facebook.com/docs/instagram-api/getting-started)
- [Facebook Access Token Guide](https://developers.facebook.com/docs/facebook-login/access-tokens/)