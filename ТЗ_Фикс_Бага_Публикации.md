# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

## üö® –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥:** –û–¥–∏–Ω –ø–æ—Å—Ç –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è 5-7 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –°–ø–∞–º –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –≤–æ–∑–º–æ–∂–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ `publish-scheduler.ts` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏  

## üìä –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø—Ä–æ–±–ª–µ–º—ã

### N8N Workflow Logs:
```
Posting TG:
- 18:42:01 - Success (5526)
- 18:41:53 - Success (5525) 
- 18:41:43 - Success (5524)
- 18:41:43 - Success (5523)
- 18:41:41 - Success (5522)
- 18:41:36 - Success (5521)
- 18:41:34 - Success (5520)

Posting VK:
- 18:40:39 - Success (5519)
- 18:40:35 - Success (5518)
- 18:40:34 - Success (5517)
- 18:40:34 - Success (5516)
- 18:40:28 - Success (5515)
- 18:40:28 - Success (5514)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 13 –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π –∑–∞ 1 –º–∏–Ω—É—Ç—É!

## üîç –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

### –ü—Ä–æ–±–ª–µ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ:

```typescript
// –ü–†–û–ë–õ–ï–ú–ù–´–ô –ö–û–î (–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø):
if (platformData.status === 'pending') {
  log(`${platform}: —Å—Ç–∞—Ç—É—Å "pending", –ì–û–¢–û–í –ö –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ô –ü–£–ë–õ–ò–ö–ê–¶–ò–ò`, 'scheduler');
  return true; // –ü–£–ë–õ–ò–ö–£–ï–ú –ú–ù–û–ì–û–ö–†–ê–¢–ù–û!
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å—á–∏—Ç–∞–µ—Ç –ª—é–±—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending` –≥–æ—Ç–æ–≤–æ–π –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è** –ø—Ä–∏–∑–Ω–∞–∫–∏ —É–∂–µ —Å–æ—Å—Ç–æ—è–≤—à–µ–π—Å—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π:

```typescript
// –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î:
// –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–©–ò–¢–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
if (platformData.status === 'published' || 
    platformData.postUrl || 
    platformData.publishedAt) {
  log(`${platform}: –£–ñ–ï –û–ü–£–ë–õ–ò–ö–û–í–ê–ù (URL: ${platformData.postUrl ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}), –ü–†–û–ü–£–°–ö–ê–ï–ú`, 'scheduler');
  return false; // –ë–õ–û–ö–ò–†–£–ï–ú –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é
}

// –¢–æ–ª—å–∫–æ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º –≤ —Å—Ç–∞—Ç—É—Å–µ 'pending' –ë–ï–ó –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
if (platformData.status === 'pending') {
  log(`${platform}: —Å—Ç–∞—Ç—É—Å "pending", –ì–û–¢–û–í –ö –ü–£–ë–õ–ò–ö–ê–¶–ò–ò`, 'scheduler');
  return true;
}
```

## üìÅ –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª:
```
server/services/publish-scheduler.ts
‚îú‚îÄ‚îÄ –ö–ª–∞—Å—Å PublishScheduler
‚îú‚îÄ‚îÄ –ú–µ—Ç–æ–¥ publishContent()
‚îî‚îÄ‚îÄ –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º
```

## üîß –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ö–ª–∞—Å—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π

```typescript
// server/services/publish-scheduler.ts
import axios from 'axios';
import { log } from '../utils/logger';

export class PublishScheduler {
  private isRunning = false;
  private intervalId: NodeJS.Timeout | null = null;
  private checkIntervalMs = 20000; // 20 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
  
  // –ö—ç—à —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π
  private adminTokenCache: string | null = null;
  private adminTokenTimestamp: number = 0;
  private tokenExpirationMs = 30 * 60 * 1000; // 30 –º–∏–Ω—É—Ç

  /**
   * –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
   */
  start() {
    if (this.isRunning) {
      log('–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π —É–∂–µ –∑–∞–ø—É—â–µ–Ω', 'scheduler');
      return;
    }

    log('–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π', 'scheduler');
    this.isRunning = true;
    
    // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
    this.checkScheduledContent();

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
    this.intervalId = setInterval(() => {
      this.checkScheduledContent();
    }, this.checkIntervalMs);
  }

  /**
   * –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
   */
  stop() {
    if (!this.isRunning || !this.intervalId) {
      log('–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –Ω–µ –∑–∞–ø—É—â–µ–Ω', 'scheduler');
      return;
    }

    log('–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π', 'scheduler');
    clearInterval(this.intervalId);
    this.intervalId = null;
    this.isRunning = false;
  }

  /**
   * –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   */
  async checkScheduledContent() {
    try {
      log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π', 'scheduler');
      
      // –ü–æ–ª—É—á–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
      const authToken = await this.getSystemToken();
      if (!authToken) {
        log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞', 'scheduler');
        return;
      }

      // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
      const scheduledContent = await this.getScheduledContent(authToken);
      
      if (!scheduledContent || scheduledContent.length === 0) {
        log('–ù–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –≥–æ—Ç–æ–≤–æ–≥–æ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏', 'scheduler');
        return;
      }

      log(`–ù–∞–π–¥–µ–Ω–æ ${scheduledContent.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏`, 'scheduler');

      // –ü—É–±–ª–∏–∫—É–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      for (const content of scheduledContent) {
        await this.publishContent(content, authToken);
      }
    } catch (error: any) {
      log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${error.message}`, 'scheduler');
    }
  }

  /**
   * –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–µ–π
   */
  async publishContent(content: any, authToken: string) {
    try {
      log(`[–ü—É–±–ª–∏–∫–∞—Ü–∏—è] –ù–∞—á–∞–ª–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ID: ${content.id}`, 'scheduler');
      
      if (!content.id || !content.campaignId) {
        log(`–ö–æ–Ω—Ç–µ–Ω—Ç —Å ID ${content.id} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏`, 'scheduler');
        return;
      }
      
      // –ñ–ï–°–¢–ö–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ü–ï–†–ï–î –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
      if (content.status === 'published') {
        log(`–ë–õ–û–ö–ò–†–û–í–ö–ê: –ö–æ–Ω—Ç–µ–Ω—Ç ${content.id} –∏–º–µ–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å "published"`, 'scheduler');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
      if (!content.socialPlatforms || typeof content.socialPlatforms !== 'object') {
        log(`–ö–æ–Ω—Ç–µ–Ω—Ç ${content.id} –Ω–µ –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º`, 'scheduler');
        return;
      }

      // –ü–∞—Ä—Å–∏–º social_platforms –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
      let platforms = content.socialPlatforms;
      if (typeof platforms === 'string') {
        try {
          platforms = JSON.parse(platforms);
        } catch (e) {
          log(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ social_platforms –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${content.id}: ${e}`, 'scheduler');
          return;
        }
      }

      log(`–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${content.id}: "${content.title}"`, 'scheduler');
      
      // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –õ–û–ì–ò–ö–ê: –§–∏–ª—å—Ç—Ä—É–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
      const platformsToPublish = Object.entries(platforms)
        .filter(([platform, platformData]: [string, any]) => {
          // –ó–ê–©–ò–¢–ê #1: –ï—Å–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
          if (platformData.status === 'published') {
            log(`  - ${platform}: —Å—Ç–∞—Ç—É—Å "published", –ü–†–û–ü–£–°–ö–ê–ï–ú`, 'scheduler');
            return false;
          }
          
          // –ó–ê–©–ò–¢–ê #2: –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å postUrl –∏–ª–∏ publishedAt - –ù–ï –ø—É–±–ª–∏–∫—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ!
          if (platformData.postUrl || platformData.publishedAt) {
            log(`  - ${platform}: –£–ñ–ï –û–ü–£–ë–õ–ò–ö–û–í–ê–ù (URL: ${platformData.postUrl ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}, –¥–∞—Ç–∞: ${platformData.publishedAt ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}), –ü–†–û–ü–£–°–ö–ê–ï–ú`, 'scheduler');
            return false;
          }
          
          // –ó–ê–©–ò–¢–ê #3: –¢–æ–ª—å–∫–æ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º –≤ —Å—Ç–∞—Ç—É—Å–µ 'pending' –ë–ï–ó –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
          if (platformData.status === 'pending') {
            log(`  - ${platform}: —Å—Ç–∞—Ç—É—Å "pending", –ì–û–¢–û–í –ö –ü–£–ë–õ–ò–ö–ê–¶–ò–ò`, 'scheduler');
            return true;
          }
          
          // –ó–ê–©–ò–¢–ê #4: –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è scheduled —Å—Ç–∞—Ç—É—Å–∞
          if (platformData.status === 'scheduled' && platformData.scheduledAt) {
            const scheduledTime = new Date(platformData.scheduledAt);
            const currentTime = new Date();
            
            if (scheduledTime <= currentTime) {
              log(`  - ${platform}: –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞—Å—Ç—É–ø–∏–ª–æ, –ì–û–¢–û–í –ö –ü–£–ë–õ–ò–ö–ê–¶–ò–ò`, 'scheduler');
              return true;
            } else {
              const diffMinutes = Math.floor((scheduledTime.getTime() - currentTime.getTime()) / 1000 / 60);
              log(`  - ${platform}: –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ ${scheduledTime.toISOString()}, –µ—â–µ ${diffMinutes} –º–∏–Ω., –ü–†–û–ü–£–°–ö–ê–ï–ú`, 'scheduler');
              return false;
            }
          }

          return false;
        });

      if (platformsToPublish.length === 0) {
        log(`–ö–æ–Ω—Ç–µ–Ω—Ç ${content.id} - –Ω–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏`, 'scheduler');
        return;
      }

      log(`–ù–∞–π–¥–µ–Ω–æ ${platformsToPublish.length} –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ${platformsToPublish.map(([p]) => p).join(', ')}`, 'scheduler');

      // –ü—É–±–ª–∏–∫—É–µ–º –≤ –∫–∞–∂–¥—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
      const publishResults = [];
      for (const [platform, platformData] of platformsToPublish) {
        const result = await this.publishToPlatform(content, platform, platformData, authToken);
        publishResults.push({ platform, result });
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
      await this.updateContentStatus(content.id, publishResults, authToken);

    } catch (error: any) {
      log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${content.id}: ${error.message}`, 'scheduler');
    }
  }

  /**
   * –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
   */
  async publishToPlatform(content: any, platform: string, platformData: any, authToken: string) {
    try {
      log(`–ó–∞–ø—É—Å–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ ${platform} –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${content.id}`, 'scheduler');
      
      // –ü–æ–ª—É—á–∞–µ–º URL webhook –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
      const webhookUrls = {
        telegram: process.env.N8N_TELEGRAM_WEBHOOK || 'https://n8n.nplanner.ru/webhook/publish-telegram',
        vk: process.env.N8N_VK_WEBHOOK || 'https://n8n.nplanner.ru/webhook/publish-vk',
        instagram: process.env.N8N_INSTAGRAM_WEBHOOK || 'https://n8n.nplanner.ru/webhook/publish-instagram'
      };

      const webhookUrl = webhookUrls[platform as keyof typeof webhookUrls];
      if (!webhookUrl) {
        throw new Error(`Webhook URL –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ${platform}`);
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º payload –¥–ª—è N8N
      const payload = {
        contentId: content.id,
        campaignId: content.campaignId,
        platform,
        title: content.title,
        content: content.content,
        mediaLinks: content.mediaLinks || [],
        hashtags: content.hashtags || [],
        scheduledAt: platformData.scheduledAt || new Date().toISOString(),
        userId: content.userId
      };

      // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –∑–∞–ø—Ä–æ—Å –≤ N8N
      const response = await axios.post(webhookUrl, payload, {
        headers: {
          'Content-Type': 'application/json'
        },
        timeout: 30000 // 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
      });

      if (response.status === 200 && response.data) {
        log(`‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ ${platform} —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${content.id}`, 'scheduler');
        
        // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ Directus, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é
        await this.updatePlatformStatus(content.id, platform, 'publishing', {
          postUrl: response.data.postUrl,
          publishedAt: new Date().toISOString()
        }, authToken);
        
        return {
          success: true,
          postUrl: response.data.postUrl,
          publishedAt: new Date().toISOString()
        };
      } else {
        throw new Error(`–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç N8N: ${response.status}`);
      }
    } catch (error: any) {
      log(`‚ùå –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ ${platform}: ${error.message}`, 'scheduler');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏
      await this.updatePlatformStatus(content.id, platform, 'failed', {
        error: error.message,
        failedAt: new Date().toISOString()
      }, authToken);
      
      return {
        success: false,
        error: error.message
      };
    }
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
   */
  async getSystemToken(): Promise<string | null> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à —Ç–æ–∫–µ–Ω–∞
    const now = Date.now();
    if (this.adminTokenCache && 
        this.adminTokenTimestamp && 
        (now - this.adminTokenTimestamp < this.tokenExpirationMs)) {
      return this.adminTokenCache;
    }

    try {
      // –ê–≤—Ç–æ—Ä–∏–∑—É–µ–º—Å—è –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      const email = process.env.DIRECTUS_ADMIN_EMAIL;
      const password = process.env.DIRECTUS_ADMIN_PASSWORD;
      
      if (!email || !password) {
        log('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö', 'scheduler');
        return null;
      }

      const directusUrl = process.env.DIRECTUS_URL || 'https://directus.nplanner.ru';
      const response = await axios.post(`${directusUrl}/auth/login`, {
        email,
        password
      });

      if (response.data?.data?.access_token) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –∫—ç—à–µ
        this.adminTokenCache = response.data.data.access_token;
        this.adminTokenTimestamp = now;
        
        log('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–∞', 'scheduler');
        return this.adminTokenCache;
      }
    } catch (error: any) {
      log(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ${error.message}`, 'scheduler');
    }

    return null;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   */
  async getScheduledContent(authToken: string): Promise<any[]> {
    try {
      const directusUrl = process.env.DIRECTUS_URL || 'https://directus.nplanner.ru';
      const currentTime = new Date();

      // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'scheduled'
      const response = await axios.get(`${directusUrl}/items/campaign_content`, {
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Content-Type': 'application/json'
        },
        params: {
          filter: JSON.stringify({
            _or: [
              { status: { _eq: 'scheduled' } },
              { status: { _eq: 'draft' } }
            ],
            social_platforms: { _nnull: true }
          }),
          limit: 100
        }
      });

      if (!response.data?.data) {
        return [];
      }

      // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç, –≥–æ—Ç–æ–≤—ã–π –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
      const readyContent = response.data.data.filter((item: any) => {
        if (!item.social_platforms) return false;

        // –ü–∞—Ä—Å–∏–º platforms
        let platforms = item.social_platforms;
        if (typeof platforms === 'string') {
          try {
            platforms = JSON.parse(platforms);
          } catch (e) {
            return false;
          }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≥–æ—Ç–æ–≤—ã–µ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        return Object.values(platforms).some((platformData: any) => {
          // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ
          if (platformData.status === 'published' || 
              platformData.postUrl || 
              platformData.publishedAt) {
            return false;
          }

          // –ì–æ—Ç–æ–≤—ã –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: pending –∏–ª–∏ scheduled —Å –Ω–∞—Å—Ç—É–ø–∏–≤—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
          if (platformData.status === 'pending') {
            return true;
          }

          if (platformData.status === 'scheduled' && platformData.scheduledAt) {
            return new Date(platformData.scheduledAt) <= currentTime;
          }

          return false;
        });
      });

      log(`–ü–æ–ª—É—á–µ–Ω–æ ${response.data.data.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∏–∑ –Ω–∏—Ö –≥–æ—Ç–æ–≤—ã –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ${readyContent.length}`, 'scheduler');
      return readyContent;
    } catch (error: any) {
      log(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${error.message}`, 'scheduler');
      return [];
    }
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤ Directus
   */
  async updatePlatformStatus(contentId: string, platform: string, status: string, additionalData: any = {}, authToken: string) {
    try {
      const directusUrl = process.env.DIRECTUS_URL || 'https://directus.nplanner.ru';
      
      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      const getResponse = await axios.get(`${directusUrl}/items/campaign_content/${contentId}`, {
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Content-Type': 'application/json'
        }
      });

      if (!getResponse.data?.data) {
        log(`–ö–æ–Ω—Ç–µ–Ω—Ç ${contentId} –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞`, 'scheduler');
        return;
      }

      let platforms = getResponse.data.data.social_platforms;
      if (typeof platforms === 'string') {
        platforms = JSON.parse(platforms);
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
      if (!platforms[platform]) {
        platforms[platform] = {};
      }

      platforms[platform] = {
        ...platforms[platform],
        status,
        platform,
        ...additionalData
      };

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      await axios.patch(`${directusUrl}/items/campaign_content/${contentId}`, {
        social_platforms: platforms
      }, {
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Content-Type': 'application/json'
        }
      });

      log(`–°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ${platform} –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${contentId} –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "${status}"`, 'scheduler');
    } catch (error: any) {
      log(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ${platform}: ${error.message}`, 'scheduler');
    }
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   */
  async updateContentStatus(contentId: string, publishResults: any[], authToken: string) {
    try {
      const successCount = publishResults.filter(r => r.result.success).length;
      const totalCount = publishResults.length;

      let newStatus = 'draft';
      if (successCount === totalCount) {
        newStatus = 'published';
      } else if (successCount > 0) {
        newStatus = 'partially_published';
      }

      const directusUrl = process.env.DIRECTUS_URL || 'https://directus.nplanner.ru';
      await axios.patch(`${directusUrl}/items/campaign_content/${contentId}`, {
        status: newStatus,
        published_at: successCount > 0 ? new Date().toISOString() : null
      }, {
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Content-Type': 'application/json'
        }
      });

      log(`–°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${contentId} –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "${newStatus}" (${successCount}/${totalCount} –ø–ª–∞—Ç—Ñ–æ—Ä–º)`, 'scheduler');
    } catch (error: any) {
      log(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ${contentId}: ${error.message}`, 'scheduler');
    }
  }
}

// –°–æ–∑–¥–∞–µ–º –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
export const publishScheduler = new PublishScheduler();
```

### 2. –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
// server/utils/logger.ts
export function log(message: string, component: string = 'system') {
  const timestamp = new Date().toLocaleTimeString('ru-RU');
  console.log(`${timestamp} [${component}] ${message}`);
}
```

### 3. –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

```typescript
// server/index.ts –∏–ª–∏ server/app.ts
import { publishScheduler } from './services/publish-scheduler';

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
publishScheduler.start();

// –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
process.on('SIGINT', () => {
  publishScheduler.stop();
  process.exit(0);
});

process.on('SIGTERM', () => {
  publishScheduler.stop();
  process.exit(0);
});
```

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–∞:
```typescript
// –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π
log(`–ë–õ–û–ö–ò–†–û–í–ö–ê: –ö–æ–Ω—Ç–µ–Ω—Ç ${contentId} —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω`, 'scheduler');
log(`${platform}: –£–ñ–ï –û–ü–£–ë–õ–ò–ö–û–í–ê–ù, –ü–†–û–ü–£–°–ö–ê–ï–ú`, 'scheduler');

// –£—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è
log(`‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ ${platform} —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞`, 'scheduler');

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
log(`–ù–∞–π–¥–µ–Ω–æ ${totalCount} —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≥–æ—Ç–æ–≤—ã –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ${readyCount}`, 'scheduler');
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:
- [ ] –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ **–æ–¥–∏–Ω —Ä–∞–∑**
- [ ] N8N workflows –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–£–ñ–ï –û–ü–£–ë–õ–ò–ö–û–í–ê–ù" –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥ –±–µ–∑ –¥—É–±–ª–µ–π

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:
- [ ] –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ Directus
- [ ] postUrl –∏ publishedAt —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –ó–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (TG, VK, IG)

### N8N –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- [ ] –í N8N –ª–æ–≥–∞—Ö –ù–ï–¢ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö workflow executions
- [ ] –ö–∞–∂–¥—ã–π workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–æ—Å—Ç
- [ ] –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ

## üö® –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:
```
N8N Logs:
18:41:34 - Posting TG - Success (5520)
18:41:36 - Posting TG - Success (5521) ‚ùå –î–£–ë–õ–¨
18:41:41 - Posting TG - Success (5522) ‚ùå –î–£–ë–õ–¨
18:41:43 - Posting TG - Success (5523) ‚ùå –î–£–ë–õ–¨
```

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:
```
N8N Logs:
18:41:34 - Posting TG - Success (5520) ‚úÖ –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø

Server Logs:
[scheduler] telegram: –£–ñ–ï –û–ü–£–ë–õ–ò–ö–û–í–ê–ù (URL: –µ—Å—Ç—å), –ü–†–û–ü–£–°–ö–ê–ï–ú
[scheduler] –ë–õ–û–ö–ò–†–û–í–ö–ê: –ö–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
```

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# N8N Webhooks
N8N_TELEGRAM_WEBHOOK=https://n8n.nplanner.ru/webhook/publish-telegram
N8N_VK_WEBHOOK=https://n8n.nplanner.ru/webhook/publish-vk
N8N_INSTAGRAM_WEBHOOK=https://n8n.nplanner.ru/webhook/publish-instagram

# Directus
DIRECTUS_URL=https://directus.nplanner.ru
DIRECTUS_ADMIN_EMAIL=admin@example.com
DIRECTUS_ADMIN_PASSWORD=secure_password
```

---

**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ  
**–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:** –ê–∫—Ç–∏–≤–Ω–∞ ‚úÖ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ ‚úÖ  
**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** N8N –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π ‚úÖ