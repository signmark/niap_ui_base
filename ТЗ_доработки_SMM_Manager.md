# Техническое задание на доработку функциональности SMM Manager

## 1. Автоматическое обновление JWT-токена (только проверка)

**Описание задачи:**  
Проверить работу существующего механизма автоматического обновления JWT-токена и убедиться, что он корректно работает.

**Решение:**
Функциональность уже реализована и работает корректно. Механизм проверяет срок действия токена и автоматически обновляет его при необходимости.

**Технические требования (выполнено):**
- Реализована проверка срока действия токена
- Реализован запрос нового токена до истечения текущего
- Обновление токена в локальном хранилище и заголовках запросов работает корректно
- Добавлена обработка сценариев ошибок

**Исходные файлы:**
- `client/src/lib/auth.ts`
- `client/src/components/AuthGuard.tsx`
- `server/services/directus-auth-manager.ts`

## 2. Оптимизация интерфейса "Запланированные"

**Описание задачи:**  
Удалить вкладку "Прошедшие" из раздела "Запланированные", так как она избыточна и вызывает путаницу у пользователей.

**Технические требования:**
- Удалить компонент вкладки "Прошедшие" из интерфейса раздела "Запланированные"
- Обновить навигацию и логику переключения вкладок
- Сохранить функциональность оставшихся вкладок

**Исходные файлы:**
- `client/src/pages/scheduled-posts-page.tsx` (или аналогичный файл с компонентом запланированных постов)
- `client/src/components/ScheduledPostsTabs.tsx` (если существует)

## 3. Массовая загрузка источников

**Описание задачи:**  
Реализовать функционал для массового добавления источников через единый интерфейс загрузки (15-20 шт. одновременно).

**Технические требования:**
- Создать единое текстовое поле для ввода списка источников
- Реализовать возможность импорта из файлов CSV/TXT в то же текстовое поле
- Реализовать автоматический парсинг имен каналов из исходных данных
- Добавить валидацию вводимых данных с понятными сообщениями об ошибках
- Обеспечить функцию предпросмотра перед окончательным импортом

**Решение:**
Создать универсальное текстовое поле, куда пользователь может вставить список источников или загрузить файл с данными. При загрузке файла его содержимое автоматически помещается в это же поле для возможного редактирования.

**Исходные файлы:**
- `client/src/pages/sources-page.tsx` (или аналогичный файл с компонентом источников)
- `client/src/components/AddSourceForm.tsx` (если существует)
- `server/routes/sources-routes.ts` (для API-эндпоинта массового добавления)

## 4. Исправление функционала добавления изображений

**Описание задачи:**  
Исправить логику работы с полями генерации изображений, чтобы кнопка "Сгенерировать" привязывалась к соответствующему полю, а не оставалась у первого.

**Технические требования:**
- Переработать компонент управления изображениями, чтобы каждое поле имело свою кнопку генерации
- Добавить возможность генерации изображений на основе промта из основного контента
- Сохранить уже сгенерированные изображения в других полях

**Решение:**
Изменить интерфейс генерации изображений, чтобы каждое поле имело свою кнопку генерации. Добавить возможность использовать текст из основного контента в качестве промта по умолчанию.

**Исходные файлы:**
- `client/src/components/ImageGenerationForm.tsx` (или аналогичный файл с компонентом генерации изображений)
- `client/src/components/ContentCreateForm.tsx` (если логика интегрирована в форму создания контента)

## 5. Корректировка аналитики (отложено)

**Описание задачи:**  
Исправить некорректные данные в разделе "Аналитика", в частности количество опубликованных постов за 7 дней и завышенные показатели просмотров.

**Решение:**
Задача отложена на более поздний срок. Реализация потребует около 2 дней работы и будет выполнена после реализации более приоритетных задач.

**Технические требования:**
- Пересмотреть методы расчета опубликованных постов (фильтрация по дате)
- Скорректировать агрегацию данных по просмотрам
- Обновить логику отображения статистики
- Добавить дополнительные проверки получаемых данных аналитики

**Исходные файлы:**
- `client/src/pages/analytics-page.tsx`
- `server/services/analytics-service.ts`
- `client/src/components/AnalyticsCharts.tsx` (или аналогичные компоненты)

## 6. Решение проблемы с Gemini 2.5 без VPN

**Описание задачи:**  
Обеспечить стабильную работу с API Gemini 2.5 без необходимости использования VPN.

**Технические требования:**
- Выяснить у службы поддержки Google статус проверки IP-адресов из Латвии
- Реализовать серверный прокси для запросов к API Gemini
- Настроить кеширование для снижения количества прямых запросов
- Добавить обработку ошибок при недоступности сервиса

**Решение:**
Сначала запросить статус проверки IP-адресов из Латвии у службы поддержки Google. В зависимости от ответа реализовать серверный прокси или настроить прямое подключение к API.

**Исходные файлы:**
- `server/services/ai-services/gemini-service.ts`
- `server/routes/ai-routes.ts`

## 7. Скрытие раздела "Настройки" (реализовано)

**Описание задачи:**  
Скрыть раздел "Настройки" для всех пользователей и настроить использование дефолтных ключей ИИ-сервисов.

**Решение:**
Задача уже реализована. Раздел "Настройки" скрыт из навигации, а аппликация использует глобальные API ключи по умолчанию.

**Технические требования (выполнено):**
- Пункт "Настройки" скрыт из навигационного меню
- Настроено использование глобальных API ключей по умолчанию
- Реализована проверка наличия ключей при запросах к ИИ-сервисам
- Настроен фолбэк на глобальные ключи при отсутствии пользовательских

**Исходные файлы:**
- `client/src/components/Sidebar.tsx` или аналогичный компонент навигации
- `server/services/api-keys.ts`
- `server/services/global-api-keys.ts`

## 8. Перевод промтов для генерации изображений (отложено)

**Описание задачи:**  
Добавить автоматический перевод русскоязычных промтов на английский перед отправкой запроса на генерацию изображения.

**Решение:**
Задача отложена. Сначала демонстрация пользователям уже реализованного функционала, затем решение о доработке.

**Технические требования:**
- Интегрировать сервис перевода (существующий DeepSeek или альтернативный)
- Реализовать автоматический перевод промтов при отправке запроса
- Добавить отдельный режим для случаев, когда текст должен остаться на русском
- Создать обработку ситуаций, когда перевод не удался 

**Исходные файлы:**
- `client/src/components/ImageGenerationDialog.tsx`
- `server/services/ai-services/deepseek-service.ts` (для перевода)
- `server/services/ai-services/fal-service.ts` (для генерации изображений)

## 9. Реализация публикации сторис

**Описание задачи:**  
Добавить тип контента для создания и публикации сторис в социальных сетях.

**Решение:**
Создать новый тип контента "Сторис", подобный обычным постам, но с специфическими настройками и форматами для сторис. Реализовать интеграцию с API социальных сетей для публикации сторис.

**Технические требования:**
- Добавить новый тип контента "Сторис" в систему
- Создать интерфейс для загрузки и редактирования сторис
- Интегрировать с API социальных сетей для публикации сторис
- Реализовать дополнительные настройки для сторис (время жизни, интерактивные элементы)
- Обеспечить отслеживание статуса публикации

**Исходные файлы:**
- Новые файлы: `client/src/pages/stories-page.tsx`, `client/src/components/StoriesEditor.tsx`
- `server/routes/stories-routes.ts`
- `server/services/platform-services/` (добавление соответствующей функциональности)

## 10. Реализация публикации на YouTube

**Описание задачи:**  
Добавить YouTube в список социальных сетей и создать функционал для публикации видео и подписей к ним.

**Решение:**
Добавить YouTube в список поддерживаемых социальных сетей. Реализовать интерфейс для загрузки видео и настройки параметров публикации. Интегрировать YouTube API для публикации и мониторинга статуса.

**Технические требования:**
- Добавить YouTube в список социальных сетей в интерфейсе публикации
- Разработать интерфейс загрузки и настройки видео (заголовок, описание, теги)
- Интегрировать YouTube API для публикации
- Реализовать индикацию процесса загрузки и обработки видео
- Обеспечить отслеживание статуса публикации

**Исходные файлы:**
- Новые файлы: `client/src/components/YouTubeUpload.tsx`
- `server/services/platform-services/youtube-service.ts`
- `server/routes/youtube-routes.ts`
- `client/src/components/ContentPublishForm.tsx` (для добавления YouTube в список социальных сетей)

## 11. Упрощение авторизации в Instagram

**Описание задачи:**  
Реализовать альтернативный способ авторизации в Instagram без необходимости получения API ключа.

**Решение:**
Разработать альтернативный механизм авторизации для Instagram, например, через OAuth или авторизацию через логин/пароль. Обеспечить безопасное хранение учетных данных и автоматическое обновление токенов доступа.

**Технические требования:**
- Реализовать альтернативный механизм авторизации в Instagram
- Создать интерфейс для авторизации через логин/пароль или OAuth
- Обеспечить безопасное хранение учетных данных в защищенном хранилище
- Реализовать автоматическое обновление токенов доступа

**Исходные файлы:**
- `client/src/components/InstagramAuthForm.tsx` (новый файл)
- `server/services/platform-services/instagram-service.ts`
- `server/routes/platform-auth-routes.ts` (новый файл)

---

**Примечание:** Функциональность "Очистка TG-тегов для других платформ" и "Исправление сбора трендов" исключена из ТЗ, так как эти задачи уже реализованы через n8n согласно начальному условию.