Вот пошаговый алгоритм работы публикации контента в SMM Manager с учетом всех указанных требований:

### 1. Создание контента
- При создании нового контента (поста или сторис) ему автоматически присваивается статус **draft**
- Поля `social_platforms` пока пустые или не заполнены

### 2. Планирование публикации
- Когда контент планируется:
  - Статус меняется на **scheduled**
  - В `social_platforms` для каждой выбранной соцсети:
    - Устанавливается конкретное время публикации
    - `selected: true` (если платформа выбрана для публикации)
    - Статус для каждой платформы пока не установлен или `pending`

### 3. Моментальная публикация (когда нажали "Опубликовать сейчас")
- При нажатии "Опубликовать сейчас":
  - Для каждой выбранной соцсети в `social_platforms`:
    - `status: "pending"`
    - `selected: true`
  - Общий статус контента может оставаться **draft** или меняться на **scheduled** (в зависимости от логики)

### 4. Процесс публикации в каждой соцсети
- Планировщик/воркер ищет записи с:
  - `selected: true`
  - `status: "pending"`
  - Время публикации ≤ текущего времени
- Для каждой найденной платформы:
  - Пытается опубликовать контент
  - После успешной публикации:
    - `status: "published"`
    - Заполняет поле `link` (или другоеимя) (ссылкой на опубликованный пост)
  - При ошибке:
    - `status: "failed"`
    - Заполняет поле `error` 

### 5. Финальный статус контента
- После публикации во ВСЕХ выбранных соцсетях (`selected: true`):
  - Если все платформы имеют статус **published**:
    - Общий статус контента меняется на **published**
  - Если хотя бы одна платформа имеет статус **failed**:
    - Общий статус может остаться **partial_published** (или аналогичным)

### Особенности для Stories
- Весь процесс идентичен обычным постам
- Единственное отличие - тип контента в `scheduled` указывается как "stories". Определяется системой автоматически и постится по соответствуюещму n8n воркфлоу

### Пример структуры данных (упрощенный):
```json
{
  "id": "123",
  "type": "post", // или "story"
  "status": "published",
  "social_platforms": [
    {
      "name": "instagram",
      "selected": true,
      "status": "published",
      "scheduled_time": "2023-11-20T15:00:00Z",
      "link": "https://instagram.com/p/ABC123",
      "published_at": "2023-11-20T15:02:12Z"
    },
    {
      "name": "facebook",
      "selected": true,
      "status": "published",
      "scheduled_time": "2023-11-20T15:00:00Z",
      "link": "https://facebook.com/xyz789",
      "published_at": "2023-11-20T15:01:45Z"
    }
  ]
}
```