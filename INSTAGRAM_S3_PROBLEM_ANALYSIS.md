# Instagram S3 –ü—Ä–æ–±–ª–µ–º–∞ - –ê–Ω–∞–ª–∏–∑ –∏ –†–µ—à–µ–Ω–∏–µ

## –û–ø–∏—Å–∞–Ω–∏–µ –ü—Ä–æ–±–ª–µ–º—ã
Instagram Graph API –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–∏–¥–µ–æ –∏–∑ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ Beget, –≤–æ–∑–≤—Ä–∞—â–∞—è –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

## –ö–æ—Ä–µ–Ω—å –ü—Ä–æ–±–ª–µ–º—ã
Instagram Graph API —Ç—Ä–µ–±—É–µ—Ç:
1. **Accept-Ranges: bytes** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤–∏–¥–µ–æ –ø–æ —á–∞—Å—Ç—è–º
2. **Content-Type: video/mp4** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MIME-—Ç–∏–ø
3. **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫ —Ñ–∞–π–ª—É –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
4. **HTTP 206 Partial Content** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è Range –∑–∞–ø—Ä–æ—Å–æ–≤

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ S3 –ø–æ–∫–∞–∑–∞–ª–æ, —á—Ç–æ Beget S3 **–ù–ï –í–û–ó–í–†–ê–©–ê–ï–¢** –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept-Ranges: bytes`, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Instagram.

## –†–µ—à–µ–Ω–∏—è

### 1. –û–±—Ä–∞—â–µ–Ω–∏–µ –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É Beget (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ)
–ù—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Beget —Å –∑–∞–ø—Ä–æ—Å–æ–º:
- –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `Accept-Ranges: bytes` –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ bucket
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ HTTP 206 Partial Content –¥–ª—è –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É CORS

**–¢–µ–∫—Å—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è:**
```
–î–æ–±—Ä—ã–π –¥–µ–Ω—å!

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Instagram Graph API –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–æ:
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ "Accept-Ranges: bytes" –¥–ª—è –≤—Å–µ—Ö –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤
2. HTTP 206 Partial Content responses –¥–ª—è Range –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API

–°–µ–π—á–∞—Å –Ω–∞—à–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Accept-Ranges –∑–∞–≥–æ–ª–æ–≤–æ–∫, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—é –≤ Instagram.

–ú–æ–∂–µ—Ç–µ –ª–∏ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–æ –¥–ª—è –Ω–∞—à–µ–≥–æ bucket?
```

### 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –•—Ä–∞–Ω–∏–ª–∏—â–∞
–ï—Å–ª–∏ Beget –Ω–µ –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É:
- **AWS S3** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Instagram —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- **Cloudflare R2** - —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å S3, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Range –∑–∞–ø—Ä–æ—Å–æ–≤
- **DigitalOcean Spaces** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

### 3. –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä (–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏-—ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–π:
- –°–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –∏–∑ S3
- –û—Ç–¥–∞–µ—Ç –µ–≥–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Range requests

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### S3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- –î–æ–±–∞–≤–ª–µ–Ω `CacheControl` –¥–ª—è –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `ContentType: video/mp4`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω `ACL: public-read`

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
–°–æ–∑–¥–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- `server/utils/instagram-video-validator.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è URL
- `server/routes/instagram-video-test.ts` - API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `quick-s3-test.js` - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Instagram Service
–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–∏–¥–µ–æ URL –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º.

## –°—Ç–∞—Ç—É—Å
üî¥ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –¥—Ä—É–≥–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

Instagram –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å `Accept-Ranges: bytes` –∑–∞–≥–æ–ª–æ–≤–∫–æ–º.