# Руководство по установке Beget S3 в проекте

Данное руководство описывает процесс установки и настройки интеграции с облачным хранилищем Beget S3 для проекта SMM Manager.

## 1. Предварительные требования

- Docker и docker-compose установлены на вашем сервере
- Учетная запись в [Beget S3](https://storage.beget.com/) с созданным бакетом
- Доступ к ключам API Beget S3 (Access Key и Secret Key)

## 2. Подготовка окружения

### 2.1. Копирование файлов конфигурации

Выполните следующие команды из директории smm:

```bash
# Копирование env.example в родительскую директорию
cp env.example ../.env

# Копирование исправленного docker-compose
cp fixed-docker-compose.yml ../docker-compose.yml
```

### 2.2. Редактирование переменных окружения

Отредактируйте файл `.env` в родительской директории и установите следующие переменные:

```
# Beget S3 Storage Configuration
BEGET_S3_ENDPOINT="https://s3.ru1.storage.beget.cloud"
BEGET_S3_REGION="ru-central-1"
BEGET_S3_BUCKET="ваш-бакет"
BEGET_S3_PUBLIC_URL="https://s3.ru1.storage.beget.cloud/ваш-бакет"
BEGET_S3_TEST_UPLOAD="false"
BEGET_S3_ACCESS_KEY="ваш_ключ_доступа"
BEGET_S3_SECRET_KEY="ваш_секретный_ключ"
```

## 3. Установка зависимостей AWS SDK

### 3.1. Установка пакетов в контейнере

Выполните скрипт установки из директории smm:

```bash
chmod +x install-aws-sdk.sh
./install-aws-sdk.sh
```

Скрипт выполнит:
1. Проверку наличия необходимых файлов
2. Установку пакетов `@aws-sdk/client-s3`, `@aws-sdk/s3-request-presigner` и `@aws-sdk/lib-storage`
3. Перезапуск контейнера для применения изменений

### 3.2. Проверка установки

Проверьте логи контейнера после перезапуска:

```bash
docker logs root-smm-1
```

Если в логах нет ошибок о не найденных модулях AWS SDK, установка прошла успешно.

## 4. Решение проблем

### 4.1. Ошибка при установке пакетов

Если при выполнении скрипта установки появляется ошибка, попробуйте пересобрать контейнер:

```bash
cd ..  # Перейти в родительскую директорию
docker-compose build --no-cache smm
docker-compose up -d
```

### 4.2. Ошибка доступа к бакету

Если приложение не может получить доступ к бакету Beget S3, проверьте:

1. Правильность ключей доступа (ACCESS_KEY и SECRET_KEY)
2. Существование указанного бакета
3. Публичный доступ к бакету и правильность настроек CORS

## 5. Тестирование интеграции

После установки и настройки вы можете протестировать интеграцию с Beget S3, попытавшись загрузить видео в систему через интерфейс приложения.

## 6. Дополнительная информация

Для получения дополнительной информации о работе с Beget S3, посетите [официальную документацию](https://storage.beget.com/docs/).