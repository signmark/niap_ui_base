# Руководство по запуску тестов в проекте

В этом проекте настроена полная инфраструктура для автоматического тестирования с использованием Jest. Файлы тестов расположены в директории `server/__tests__/`.

## Установленные инструменты для тестирования

- **Jest**: фреймворк для тестирования JavaScript
- **ts-jest**: поддержка TypeScript для Jest
- **axios-mock-adapter**: мокирование HTTP-запросов
- **form-data**: работа с формами для тестирования API

## Структура тестовых файлов

1. **jest.setup.js** - настройка Jest для всех тестов
2. **setup.ts** - общая настройка тестового окружения
3. **test-utils.ts** - вспомогательные функции и константы для тестов
4. **telegram-service.test.ts** - тесты для Telegram сервиса
5. **social-post-types.test.ts** - тесты для разных типов публикаций в соцсетях
6. Другие тестовые файлы для различных компонентов системы

## Запуск тестов

### Запуск всех тестов
```bash
node run-tests.js
```

### Запуск тестов с красивым выводом в стиле pytest
```bash
node run-tests.js --pretty
```

### Запуск конкретных тестов
```bash
node run-tests.js server/__tests__/telegram-service.test.ts
```

### Запуск тестов в режиме наблюдения (watch mode)
```bash
node run-tests.js --watch
```

## Доступные команды для тестирования

Для более удобного запуска тестов вы можете добавить следующие скрипты в package.json:

```json
"scripts": {
  "test": "node run-tests.js",
  "test:pretty": "node run-tests.js --pretty",
  "test:watch": "node run-tests.js --watch",
  "test:telegram": "node run-tests.js server/__tests__/telegram-service.test.ts",
  "test:social": "node run-tests.js server/__tests__/social-post-types.test.ts"
}
```

После добавления этих скриптов вы сможете использовать команды:
- `npm test` - запуск всех тестов
- `npm run test:pretty` - запуск с красивым выводом
- `npm run test:watch` - запуск в режиме наблюдения
- `npm run test:telegram` - запуск только тестов Telegram
- `npm run test:social` - запуск только тестов типов социальных публикаций

## Создание новых тестов

При создании новых тестовых файлов, следуйте соглашению о наименовании: `*.test.ts` и размещайте их в директории `server/__tests__/`.

Пример структуры нового тестового файла:

```typescript
import { ... } from '../путь/к/тестируемому/модулю';
import { 
  // Импортируйте вспомогательные функции
} from './test-utils';
import { mocks, config } from './setup';

describe('Название тестируемого модуля', () => {
  // Настройка перед каждым тестом
  beforeEach(() => {
    // ...
  });
  
  // Очистка после каждого теста
  afterEach(() => {
    // ...
  });
  
  // Группа тестов для конкретной функциональности
  describe('Название тестируемой функциональности', () => {
    it('должен делать что-то конкретное', async () => {
      // Подготовка
      
      // Действие
      
      // Проверка
      expect(...).toBe(...);
    });
  });
});
```

## Рекомендации по написанию тестов

1. Используйте `mocks` и функции из `test-utils.ts` для мокирования внешних зависимостей
2. Изолируйте тесты, чтобы они не зависели друг от друга
3. Проверяйте как успешные сценарии, так и сценарии с ошибками
4. Для тестирования API используйте моки axios
5. Добавляйте информативные сообщения в утверждения (assertions)

## Отладка тестов

Если тесты не проходят, вы можете использовать различные методы отладки:

1. Добавьте `console.log` для вывода промежуточных значений
2. Запустите тест с `--verbose` для подробного вывода
3. Используйте Jest Snapshot Testing для сложных объектов
4. Запустите конкретный тест с флагом `--watch` для непрерывного тестирования при изменении кода