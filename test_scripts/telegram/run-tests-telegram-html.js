/**
 * –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Telegram
 * –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTML-—Ç–µ–≥–æ–≤
 * –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
 * 
 * –ó–∞–ø—É—Å–∫: node run-tests-telegram-html.js
 */
import axios from 'axios';
import { config } from 'dotenv';

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
config();

// API URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
const API_URL = process.env.API_URL || 'http://localhost:5000';

// ID –∫–∞–º–ø–∞–Ω–∏–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
const CAMPAIGN_ID = process.env.CAMPAIGN_ID || '46868c44-c6a4-4bed-accf-9ad07bba790e';

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ –∫–∞–º–ø–∞–Ω–∏–∏
let settings = {
  telegram: {
    token: process.env.TELEGRAM_BOT_TOKEN || '7529101043:AAG298h0iubyeKPuZ-WRtEFbNEnEyqy_XJU',
    chatId: process.env.TELEGRAM_CHAT_ID || '-1002302366310'
  }
};

// –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const testCases = [
  {
    name: '1. –ë–∞–∑–æ–≤—ã–µ HTML-—Ç–µ–≥–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö HTML-—Ç–µ–≥–æ–≤ Telegram',
    text: `<b>–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b>

<i>–ö—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç</i>

<u>–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç</u>

<s>–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç</s>

<code>–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</code>

<a href="https://example.com">–°—Å—ã–ª–∫–∞</a>

<pre>
function test() {
  return '–ë–ª–æ–∫ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞';
}
</pre>`
  },
  {
    name: '2. –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö HTML-—Ç–µ–≥–æ–≤',
    text: `<b>–í–ª–æ–∂–µ–Ω–Ω—ã–π <i>—Ç–µ–∫—Å—Ç —Å</i> —Ä–∞–∑–Ω—ã–º–∏ <u>—Ç–µ–≥–∞–º–∏</u></b>

<b><i><u>–¢—Ä–∏ —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏</u></i></b>

<b>–¢–µ–∫—Å—Ç —Å <a href="https://example.com">—Å—Å—ã–ª–∫–æ–π</a> –≤–Ω—É—Ç—Ä–∏ –∂–∏—Ä–Ω–æ–≥–æ</b>

<i>–ö—É—Ä—Å–∏–≤ —Å <code>–∫–æ–¥–æ–º</code> –≤–Ω—É—Ç—Ä–∏</i>`
  },
  {
    name: '3. –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–µ–≥–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö HTML-—Ç–µ–≥–æ–≤',
    text: `<b>–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–≥ –∂–∏—Ä–Ω–æ–≥–æ

<i>–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–≥ –∫—É—Ä—Å–∏–≤–∞

<u>–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–≥ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è

<s>–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–≥ –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è

<code>–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–≥ –∫–æ–¥–∞

–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–µ–≥–æ–≤`
  },
  {
    name: '4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–µ–≥–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º –∑–∞–∫—Ä—ã—Ç–∏—è',
    text: `<b>–ñ–∏—Ä–Ω—ã–π <i>–∫—É—Ä—Å–∏–≤–Ω—ã–π</b> —Ç–µ–∫—Å—Ç</i>

<u>–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π <b>–∂–∏—Ä–Ω—ã–π <i>–∫—É—Ä—Å–∏–≤–Ω—ã–π</u> —Ç–µ–∫—Å—Ç</i></b>

<b>–ñ–∏—Ä–Ω—ã–π <u>–ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π <i>–∫—É—Ä—Å–∏–≤–Ω—ã–π</b> —Ç–µ–∫—Å—Ç</u></i>

–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–µ–≥–æ–≤`
  },
  {
    name: '5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ —Å HTML-—Ç–µ–≥–∞–º–∏',
    text: `<b>–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫:</b>

‚Ä¢ <i>–ö—É—Ä—Å–∏–≤–Ω—ã–π –ø—É–Ω–∫—Ç</i>
‚Ä¢ <u>–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π –ø—É–Ω–∫—Ç</u>
‚Ä¢ <b>–ñ–∏—Ä–Ω—ã–π –ø—É–Ω–∫—Ç</b>
‚Ä¢ <s>–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π –ø—É–Ω–∫—Ç</s>
‚Ä¢ <code>–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</code>
‚Ä¢ <a href="https://example.com">–ü—É–Ω–∫—Ç —Å–æ —Å—Å—ã–ª–∫–æ–π</a>
‚Ä¢ –ü—É–Ω–∫—Ç —Å <b>–≤–ª–æ–∂–µ–Ω–Ω—ã–º <i>—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º</i></b>`
  },
  {
    name: '6. –ú–∞—Ä–∫–¥–∞—É–Ω –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ Markdown –≤ HTML-—Ç–µ–≥–∏',
    text: `**–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ markdown**

*–ö—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ markdown*

__–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç –∏–∑ markdown__

~~–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç –∏–∑ markdown~~

\`–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ markdown\`

**–ñ–∏—Ä–Ω—ã–π —Å *–≤–ª–æ–∂–µ–Ω–Ω—ã–º –∫—É—Ä—Å–∏–≤–æ–º* –∏–∑ markdown**`
  },
  {
    name: '7. –°–º–µ—à–∞–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–º–∏ —Ç–µ–≥–∞–º–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–º–∏ —Ç–µ–≥–∞–º–∏',
    text: `<b>–ó–∞–≥–æ–ª–æ–≤–æ–∫</b>

<i>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫—É—Ä—Å–∏–≤–æ–º</i>

–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç

‚Ä¢ <u>–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π –ø—É–Ω–∫—Ç</u>
‚Ä¢ <b>–ñ–∏—Ä–Ω—ã–π <i>—Å –∫—É—Ä—Å–∏–≤–æ–º</i> –ø—É–Ω–∫—Ç

<code>console.log('Hello world');</code>

<b>–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π –∂–∏—Ä–Ω—ã–π —Å <i>–Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–º –∫—É—Ä—Å–∏–≤–æ–º –∏ <u>–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ–º`
  },
  {
    name: '8. –î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º',
    text: `<b>–î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º</b>

${`<i>–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è —Ç–µ–∫—Å—Ç —Å –∫—É—Ä—Å–∏–≤–æ–º. </i>`.repeat(50)}

<u>–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ.</u>

${`<b>–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç. </b>`.repeat(50)}

<code>–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –∫–æ–Ω—Ü–µ –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</code>`
  },
  {
    name: '9. HTML-—Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTML-—Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤',
    text: `<b>–¢–µ–∫—Å—Ç —Å HTML-—Å—É—â–Ω–æ—Å—Ç—è–º–∏</b>

&lt;–≠—Ç–æ –Ω–µ —Ç–µ–≥&gt;

&amp; - –∞–º–ø–µ—Ä—Å–∞–Ω–¥

&quot;–ö–∞–≤—ã—á–∫–∏&quot;

&apos;–ê–ø–æ—Å—Ç—Ä–æ—Ñ&apos;

<code>&lt;b&gt;–≠—Ç–æ –∫–æ–¥, –∞ –Ω–µ –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç&lt;/b&gt;</code>

–¢–µ–∫—Å—Ç < —Å > —Å–∏–º–≤–æ–ª–∞–º–∏ & –±–µ–∑ & —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è`
  },
  {
    name: '10. –¢–µ–≥–∏ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏',
    description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–≥–æ–≤ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏',
    text: `<a href="https://example.com" title="–ü—Ä–∏–º–µ—Ä —Å—Å—ã–ª–∫–∏">–°—Å—ã–ª–∫–∞ —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º title</a>

<a href="https://example.com" target="_blank" rel="nofollow">–°—Å—ã–ª–∫–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏</a>

<a href="https://example.com" style="color: red;">–°—Å—ã–ª–∫–∞ —Å–æ —Å—Ç–∏–ª–µ–º</a>

<a href="https://example.com" onclick="alert('click')">–°—Å—ã–ª–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º</a>

<b style="color: red;">–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º style</b>

<i class="some-class">–ö—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º class</i>`
  }
];

/**
 * –í—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
 * @returns {void}
 */
function loadSettings() {
  console.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Telegram:');
  console.log(`–ö–∞–Ω–∞–ª: ${settings.telegram.chatId}`);
  console.log(`–¢–æ–∫–µ–Ω: ${settings.telegram.token.substring(0, 10)}...`);
}

/**
 * –ü—É–±–ª–∏–∫—É–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
 * @param {object} testCase –¢–µ—Å—Ç–æ–≤—ã–π —Å–ª—É—á–∞–π
 * @param {number} index –ò–Ω–¥–µ–∫—Å —Ç–µ—Å—Ç–∞
 * @returns {Promise<object>} –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
 */
async function runTest(testCase, index) {
  try {
    console.log(`\n----- –¢–µ—Å—Ç ${index+1}/${testCases.length}: ${testCase.name} -----`);
    console.log(`–û–ø–∏—Å–∞–Ω–∏–µ: ${testCase.description}`);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    const testHeader = `üß™ <b>–¢–ï–°–¢ HTML-–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø #${index+1}</b>: ${testCase.name}\n\n`;
    const testContent = testHeader + testCase.text;
    
    // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    console.log(`–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ API...`);
    const response = await axios.post(`${API_URL}/api/test/telegram-post`, {
      text: testContent,
      chatId: settings.telegram.chatId,
      token: settings.telegram.token
    });
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
    if (response.data && response.data.success) {
      const result = response.data.data;
      console.log(`‚úÖ –£–°–ü–ï–•: –¢–µ—Å—Ç #${index+1} –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!`);
      
      if (result.postUrl) {
        console.log(`üîó URL —Å–æ–æ–±—â–µ–Ω–∏—è: ${result.postUrl}`);
      }
      
      if (result.messageId) {
        console.log(`üìù ID —Å–æ–æ–±—â–µ–Ω–∏—è: ${result.messageId}`);
      }
      
      return { 
        success: true, 
        messageId: result.messageId,
        postUrl: result.postUrl 
      };
    } else {
      console.log(`‚ùå –û–®–ò–ë–ö–ê: –¢–µ—Å—Ç #${index+1} –Ω–µ –ø—Ä–æ–π–¥–µ–Ω!`);
      
      if (response.data && response.data.error) {
        console.log(`–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏: ${response.data.error}`);
      }
      
      console.log(JSON.stringify(response.data, null, 2));
      
      return { 
        success: false, 
        error: response.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' 
      };
    }
  } catch (error) {
    console.error(`‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ #${index+1}:`, error.message);
    
    if (error.response) {
      console.error('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', error.response.status);
      console.error('–î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', JSON.stringify(error.response.data, null, 2));
    }
    
    return { 
      success: false, 
      error: error.message 
    };
  }
}

/**
 * –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –∏ –≤—ã–≤–æ–¥–∏—Ç –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
 */
async function runAllTests() {
  console.log('======================================================');
  console.log('üß™ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í HTML-–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø –í TELEGRAM');
  console.log('======================================================\n');
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  await loadSettings();
  
  // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
  const results = [];
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ
  for (let i = 0; i < testCases.length; i++) {
    const result = await runTest(testCases[i], i);
    results.push(result);
    
    // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã API Telegram
    if (i < testCases.length - 1) {
      console.log('‚è≥ –ü–∞—É–∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —Ç–µ—Å—Ç–æ–º...');
      await new Promise(resolve => setTimeout(resolve, 3000));
    }
  }
  
  // –í—ã–≤–æ–¥–∏–º –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  console.log('\n======================================================');
  console.log('üìä –°–í–û–î–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –¢–ï–°–¢–û–í:');
  console.log('======================================================');
  
  // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
  const successCount = results.filter(r => r.success).length;
  
  // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
  for (let i = 0; i < testCases.length; i++) {
    const status = results[i].success ? '‚úÖ –£–°–ü–ï–•' : '‚ùå –û–®–ò–ë–ö–ê';
    console.log(`${status}: –¢–µ—Å—Ç #${i+1} - ${testCases[i].name}`);
    
    if (!results[i].success && results[i].error) {
      console.log(`   –ü—Ä–∏—á–∏–Ω–∞: ${results[i].error}`);
    }
    
    if (results[i].postUrl) {
      console.log(`   URL: ${results[i].postUrl}`);
    }
  }
  
  // –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  console.log('\n======================================================');
  console.log(`–ò–¢–û–ì–û: ${successCount}/${testCases.length} —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ`);
  
  if (successCount === testCases.length) {
    console.log('‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!');
  } else {
    console.log(`‚ùå ${testCases.length - successCount} –¢–ï–°–¢–û–í –ù–ï –ü–†–û–ô–î–ï–ù–û!`);
  }
  console.log('======================================================');
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã
runAllTests().catch(error => {
  console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤:', error);
  process.exit(1);
});