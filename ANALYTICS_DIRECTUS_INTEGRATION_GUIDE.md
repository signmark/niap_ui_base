# Руководство по интеграции аналитики с Directus API

## Текущая реализация и ограничения

Система аналитики SMM Менеджера предназначена для сбора и отображения статистики публикаций из различных социальных сетей. Данная документация описывает особенности взаимодействия с Directus API и механизмы обеспечения стабильной работы при возникновении проблем с доступом.

### Ограничения доступа к Directus

В текущей реализации возникают ограничения при доступе к некоторым коллекциям Directus, в частности:

1. Коллекция "campaigns" - возвращает ошибку 403 (Forbidden)
2. Коллекция "campaign_content" - возвращает ошибку 403 (Forbidden)

Эти ограничения связаны с настройками прав доступа в Directus и могут быть обусловлены:
- Недостаточными правами для токена администратора
- Изменениями в структуре коллекций
- Настройками безопасности Directus

### Механизм использования fallback-данных

Для обеспечения бесперебойной работы приложения при проблемах с доступом к API, реализован механизм fallback-данных:

1. При запросе аналитики сервис пытается получить реальные данные из Directus
2. В случае ошибки (403, 404, 500 и т.д.) или таймаута, сервис возвращает предварительно подготовленные тестовые данные
3. Клиент отображает эти данные с уведомлением пользователя о временном использовании тестовых данных

### Обработка ошибок

В настоящее время система реализует каскадную обработку ошибок:

1. Первичная попытка получения данных через стандартный API
2. При неудаче - возврат подготовленных данных из модуля fallback-data.ts
3. Соответствующее логирование всех ошибок для последующего анализа

## Рекомендуемые улучшения

### Настройка прав доступа в Directus

Необходимо проверить настройки прав для токена администратора и убедиться, что у него есть доступ к:
- Чтению коллекции campaigns
- Чтению и записи в коллекцию campaign_content
- Доступу к полям social_platforms и social_media_settings

### Обновление структуры данных

Возможно, проблема связана с несоответствием структуры данных. Необходимо убедиться, что:
1. В коллекции campaign_content действительно существует поле campaign_id
2. Поле social_platforms имеет корректную структуру для хранения аналитических данных
3. Настройки схемы соответствуют фактической структуре БД

### Альтернативный подход к сбору аналитики

В случае постоянных проблем с доступом через Directus, можно рассмотреть:
1. Прямое подключение к базе данных PostgreSQL, минуя Directus API
2. Создание отдельной коллекции для хранения аналитических данных с менее ограниченным доступом
3. Использование внешнего сервиса для хранения аналитики (например, отдельная БД или облачное хранилище)

## Заключение

Данная проблема доступа требует административного вмешательства на уровне Directus. До решения основной проблемы, механизм использования fallback-данных обеспечивает стабильную работу интерфейса приложения без критических сбоев.