# Техническое задание на доработку планировщика публикаций

## Общее описание
Необходимо модифицировать планировщик публикаций в социальных сетях для корректной обработки контента со статусом "scheduled" и платформ с различными статусами публикации. Цель - обеспечить правильное обновление основного статуса контента в зависимости от результатов публикации в социальных сетях.

## Требования к обработке статусов платформ

### 1. Обработка платформ со статусом "scheduled"
- Система должна обнаруживать платформы со статусом "scheduled" в контенте
- Платформы со статусом "scheduled" должны обрабатываться как готовые к публикации
- При обнаружении платформы со статусом "scheduled" система должна пытаться опубликовать контент в эту платформу

### 2. Обновление статуса контента
- Статус контента должен меняться на "published" **ТОЛЬКО** если все выбранные социальные сети имеют статус "published"
- Если хотя бы одна выбранная платформа имеет статус "error", основной статус контента **не должен** меняться на "published"
- Если хотя бы одна выбранная платформа имеет статус отличный от "published" (например, "pending", "scheduled"), основной статус контента не должен меняться

### 3. Логирование и обработка ошибок
- При обнаружении платформ со статусом "error" должна быть добавлена дополнительная запись в лог
- Логи должны содержать информацию о количестве и названиях платформ с ошибками
- Система должна продолжать работу и не должна блокироваться при обнаружении ошибок в публикации

## Технические особенности реализации

### Метод `checkAndUpdateContentStatuses()`
Модифицировать метод `checkAndUpdateContentStatuses()` в классе `PublishScheduler`:

1. Изменить условия для обновления статуса контента:
   - Использовать флаг `allSelectedPublished` для определения, что все выбранные платформы имеют статус "published"
   - Добавить дополнительную проверку на наличие платформ со статусом "error"
   - Если есть платформы с ошибками, не менять статус контента и добавлять соответствующую запись в лог

2. Логирование статусов платформ:
   - Добавить детальное логирование для платформ с ошибками
   - Указывать в логах количество платформ в различных статусах

### Метод `checkScheduledContent()`
Модифицировать метод `checkScheduledContent()` в классе `PublishScheduler`:

1. Добавить обработку платформ со статусом "scheduled":
   - При обходе платформ в `socialPlatforms` добавить проверку на статус "scheduled"
   - Если платформа имеет статус "scheduled", считать её готовой к публикации

2. Изменить логику фильтрации контента для публикации:
   - Учитывать платформы со статусом "scheduled" при определении готовности контента к публикации
   - Добавить соответствующие записи в логи

## Ожидаемый результат
- Система корректно обрабатывает контент со статусом "scheduled"
- Система публикует контент в платформы со статусом "pending" или "scheduled"
- Основной статус контента меняется на "published" только при успешной публикации во все выбранные платформы
- При наличии ошибок публикации основной статус контента не меняется
- Все действия системы логируются с детальной информацией о статусах платформ

## Диагностика и тестирование
После внесения изменений необходимо проверить:

1. Обработку контента со статусом "scheduled" и различными статусами платформ:
   - Все платформы "published" → статус контента меняется на "published"
   - Хотя бы одна платформа с "error" → статус контента не меняется
   - Смешанные статусы платформ → статус контента не меняется до публикации во все платформы

2. Корректность работы планировщика:
   - Планировщик продолжает работать без ошибок
   - Логи содержат всю необходимую информацию о статусах платформ и принятых решениях

3. Отсутствие негативного влияния на другие части системы:
   - Обновление статусов не влияет на другие функции системы
   - Сохраняется обратная совместимость с существующим кодом