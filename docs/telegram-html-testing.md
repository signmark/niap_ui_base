# Тестирование HTML-форматирования в Telegram

Этот документ описывает процесс тестирования HTML-форматирования в Telegram и возможности системы по отправке сообщений с изображениями.

## Обзор функциональности

Система поддерживает следующие возможности для публикации контента в Telegram:

1. **HTML-форматирование текста**:
   - Жирный текст (`<b>`)
   - Курсивный текст (`<i>`)
   - Подчеркнутый текст (`<u>`)
   - Зачеркнутый текст (`<s>`)
   - Моноширинный текст (`<code>`)
   - Вложенные теги (например, `<b>жирный <i>курсив</i></b>`)
   - Ссылки (`<a href="...">`)

2. **Отправка изображений**:
   - Одиночное изображение с HTML-подписью
   - Группа изображений (до 10) с HTML-подписью

3. **Обработка длинных сообщений**:
   - Для текста длиннее 1000 символов изображение отправляется отдельно, а затем отправляется текст
   - Для текста короче 1000 символов текст отправляется как подпись к изображению

## Тестовый скрипт

Для тестирования этих возможностей был создан скрипт `test-telegram-html-with-images.js`, который выполняет следующие тесты:

1. **Тест отправки HTML-сообщения** - проверяет корректность форматирования HTML-текста без изображений
2. **Тест отправки изображения с HTML-подписью** - проверяет отправку одиночного изображения с форматированной подписью
3. **Тест отправки группы изображений с HTML-подписью** - проверяет отправку нескольких изображений с форматированной подписью

## Запуск тестов

Для запуска тестов выполните следующую команду:

```bash
node test-telegram-html-with-images.js
```

## Результаты тестирования

Все тесты выполняются последовательно и выводят результаты в консоль. Успешное выполнение теста означает, что:

1. HTML-форматирование корректно отображается в Telegram
2. Изображения успешно отправляются
3. Система правильно формирует URL сообщения в Telegram
4. Обработка ошибок работает корректно

## Примеры форматирования

Тестовый скрипт демонстрирует следующие элементы форматирования:

```html
<b>Жирный текст</b>
<i>Курсивный текст</i>
<u>Подчеркнутый текст</u>
<s>Зачеркнутый текст</s>
<code>Моноширинный текст</code>
<b>Вложенный <i>текст</i></b>
<a href="https://t.me/ya_delayu_moschno">Ссылка</a>
```

## Известные ограничения

1. Telegram поддерживает ограниченный набор HTML-тегов
2. Максимальная длина подписи к изображению - 1024 символа
3. В одной группе можно отправить не более 10 изображений
4. Некоторые изображения могут быть недоступны для загрузки ботом из-за серверных ограничений

## Обработка ошибок

Система автоматически проверяет доступность изображений перед отправкой и выполняет следующие действия в случае ошибок:

1. Если изображение недоступно - отправляется только текст
2. Если текст содержит невалидные HTML-теги - применяется автоматическое исправление
3. Если исправление невозможно - текст отправляется без форматирования

## Запуск в производственной среде

Для использования в production окружении необходимо:

1. Указать токен бота Telegram в переменной окружения `TELEGRAM_BOT_TOKEN`
2. Указать ID чата в переменной окружения `TELEGRAM_CHAT_ID`

Альтернативно, токен и ID чата могут быть получены из настроек кампании при публикации через API.