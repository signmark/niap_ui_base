# Внесенные изменения для интеграции через n8n webhooks

## Исправленные файлы

### 1. `client/src/pages/content/index.tsx`

Изменена основная функция публикации контента в социальные сети. Вместо отправки запросов через API-эндпоинт `/api/content/${id}/publish-social`, теперь используем прямые webhook URLs для каждой платформы:

- Telegram: `https://n8n.nplanner.ru/webhook/publish-telegram`
- ВКонтакте: `https://n8n.nplanner.ru/webhook/publish-vk`

Реализован механизм параллельной публикации на разные платформы с индивидуальной обработкой ошибок для каждой платформы.

### 2. `client/src/components/SocialPublishingPanel.tsx`

Обновлен компонент для поддержки webhook-интеграции. 

## Основные изменения в логике работы

### Старый подход (до изменений)
- Клиент отправлял запрос к API приложения
- API запрашивал данные контента из Directus
- API управлял логикой публикации для каждой платформы
- Требовался полный набор данных контента для каждой публикации

### Новый подход (после изменений)
- Клиент отправляет только ID контента напрямую в n8n webhook
- n8n workflow самостоятельно запрашивает данные контента
- Логика публикации полностью сосредоточена внутри n8n workflow
- Упрощенный JSON-формат запроса: `{ "contentId": "123-456-789" }`

## Преимущества нового подхода
- Уменьшение нагрузки на основной сервер приложения
- Изолированная логика публикации для каждой платформы
- Централизованное управление логикой публикации через n8n
- Улучшенная возможность мониторинга и отслеживания ошибок
- Возможность легко добавлять новые платформы без изменения клиентского кода

## Требования для работы
- Доступность n8n сервера по адресу: `https://n8n.nplanner.ru`
- Корректно настроенные workflow в n8n для каждой платформы
- Правильные права доступа для webhook endpoints

## Дальнейшие шаги
- Добавление webhooks для остальных социальных платформ
- Улучшение обработки ошибок и повторных попыток
- Внедрение механизма обратной связи о статусе публикации