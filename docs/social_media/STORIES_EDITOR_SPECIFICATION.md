# Техническое Задание: Редактор Instagram Stories

## 1. Обзор функциональности

Создать полноценный редактор для создания и редактирования Instagram Stories с возможностью:
- Создания многослайдовых историй
- Добавления различных типов контента (текст, изображения, видео)
- Применения стилизации и эффектов
- Планирования публикации
- Интеграции с существующей системой кампаний

## 2. Структура данных

### 2.1 Новый тип контента в campaign_content
```typescript
type ContentType = 'post' | 'story' | 'reel' | 'carousel'
```

### 2.2 Структура Story Content
```typescript
interface StoryContent {
  id: string;
  campaignId: string;
  type: 'story';
  slides: StorySlide[];
  title: string;
  scheduledAt?: Date;
  status: 'draft' | 'scheduled' | 'published' | 'failed';
  platformSettings: {
    instagram: {
      duration: number; // секунды на слайд
      interactive_elements?: InteractiveElement[];
    }
  };
}

interface StorySlide {
  id: string;
  order: number;
  background: BackgroundConfig;
  elements: StoryElement[];
  duration: number; // 1-15 секунд
  animation?: AnimationConfig;
}

interface StoryElement {
  id: string;
  type: 'text' | 'image' | 'video' | 'sticker' | 'poll' | 'question';
  position: { x: number; y: number; width: number; height: number };
  rotation: number;
  zIndex: number;
  content: any; // зависит от типа
  style?: ElementStyle;
}

interface BackgroundConfig {
  type: 'color' | 'gradient' | 'image' | 'video';
  value: string | GradientConfig | MediaConfig;
}
```

## 3. UI/UX Компоненты

### 3.1 Основной редактор (StoryEditor)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: Название истории | Сохранить | Опубликовать        │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────────────────┐ ┌─────────────┐ │
│ │   Слайды    │ │      Canvas Area        │ │ Инструменты │ │
│ │             │ │    (9:16 превью)        │ │             │ │
│ │ [Slide 1]   │ │                         │ │ 📝 Текст    │ │
│ │ [Slide 2]   │ │   ┌─────────────────┐   │ │ 🖼️  Медиа   │ │
│ │ [Slide 3]   │ │   │                 │   │ │ 🎨 Фон      │ │
│ │     +       │ │   │   Story Content │   │ │ ⭐ Стикеры  │ │
│ │             │ │   │                 │   │ │ 📊 Опросы   │ │
│ │             │ │   └─────────────────┘   │ │ ❓ Вопросы  │ │
│ └─────────────┘ └─────────────────────────┘ └─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Timeline: [◄] [▷] Слайд 1 из 3 | Длительность: 5 сек       │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 Панель слайдов (SlidePanel)
- Миниатюры всех слайдов с drag-and-drop для переупорядочивания
- Кнопка добавления нового слайда
- Контекстное меню для каждого слайда (дублировать, удалить)
- Индикация активного слайда

### 3.3 Canvas область (StoryCanvas)
- Соотношение сторон 9:16 (Instagram Stories)
- Drag-and-drop для элементов
- Resize handles для изменения размера
- Rotation handles для поворота
- Контекстное меню правой кнопкой мыши
- Сетка для выравнивания (опционально)

### 3.4 Панель инструментов (ToolsPanel)
```
┌─────────────────┐
│ 📝 Добавить текст│
│ 🖼️  Загрузить медиа│
│ 🎨 Изменить фон  │
│ ⭐ Добавить стикер│
│ 📊 Создать опрос │
│ ❓ Добавить вопрос│
│                 │
│ 🗂️  Шаблоны     │
│ 🎭 Анимации     │
│ ⚙️  Настройки   │
└─────────────────┘
```

## 4. Функциональные компоненты

### 4.1 Текстовый редактор (TextEditor)
- Выбор шрифта из предустановленного набора
- Размер текста (регулировка слайдером)
- Цвет текста (цветовая палитра)
- Стили: жирный, курсив, подчеркивание
- Выравнивание: лево, центр, право
- Обводка и тень текста
- Фон для текста (полупрозрачный)

### 4.2 Медиа загрузчик (MediaUploader)
- Поддержка изображений (JPG, PNG, GIF)
- Поддержка видео (MP4, MOV до 15 сек)
- Drag-and-drop загрузка
- Кроппинг и масштабирование
- Фильтры и эффекты

### 4.3 Настройки фона (BackgroundEditor)
- Сплошной цвет (цветовая палитра)
- Градиенты (линейный, радиальный)
- Изображение (с опциями покрытия)
- Видео фон (короткие зацикленные видео)

### 4.4 Интерактивные элементы
- **Опросы**: Вопрос + 2-4 варианта ответа
- **Вопросы**: Открытое поле для ответа
- **Стикеры**: Предустановленная библиотека
- **Локация**: Привязка к месту
- **Хэштеги**: Автодополнение популярных

## 5. API Endpoints

### 5.1 CRUD операции для Stories
```typescript
POST   /api/stories              // Создать новую историю
GET    /api/stories/:id          // Получить историю
PUT    /api/stories/:id          // Обновить историю
DELETE /api/stories/:id          // Удалить историю
GET    /api/campaigns/:id/stories // Все истории кампании

// Операции со слайдами
POST   /api/stories/:id/slides           // Добавить слайд
PUT    /api/stories/:id/slides/:slideId  // Обновить слайд
DELETE /api/stories/:id/slides/:slideId  // Удалить слайд
POST   /api/stories/:id/slides/reorder   // Изменить порядок
```

### 5.2 Медиа операции
```typescript
POST /api/stories/upload-media    // Загрузка медиа файлов
POST /api/stories/process-video   // Обработка видео (обрезка, конвертация)
GET  /api/stories/templates       // Получить шаблоны историй
```

### 5.3 Публикация
```typescript
POST /api/stories/:id/schedule    // Запланировать публикацию
POST /api/stories/:id/publish     // Опубликовать немедленно
GET  /api/stories/:id/preview     // Получить превью для публикации
```

## 6. Интеграция с существующей системой

### 6.1 Связь с кампаниями
- Stories создаются в контексте кампании
- Используют данные кампании для автозаполнения
- Интегрируются с планировщиком публикаций

### 6.2 Медиа менеджмент
- Интеграция с существующей системой загрузки медиа
- Использование CDN для хранения и доставки
- Автоматическая оптимизация под формат Stories

### 6.3 Публикация в Instagram
- Интеграция с Instagram Business API
- Поддержка всех интерактивных элементов
- Обработка ошибок и уведомления о статусе

## 7. Технические требования

### 7.1 Frontend (React компоненты)
```
client/src/components/stories/
├── StoryEditor.tsx           // Основной редактор
├── SlidePanel.tsx           // Панель слайдов
├── StoryCanvas.tsx          // Canvas область
├── ToolsPanel.tsx           // Панель инструментов
├── elements/
│   ├── TextEditor.tsx       // Редактор текста
│   ├── MediaUploader.tsx    // Загрузчик медиа
│   ├── BackgroundEditor.tsx // Редактор фона
│   ├── StickerPicker.tsx    // Выбор стикеров
│   └── InteractiveElements/ // Опросы, вопросы
├── templates/
│   └── TemplateLibrary.tsx  // Библиотека шаблонов
└── preview/
    └── StoryPreview.tsx     // Превью для публикации
```

### 7.2 Backend (API маршруты)
```
server/routes/stories/
├── stories.ts               // CRUD операции
├── slides.ts               // Операции со слайдами
├── media.ts                // Медиа операции
├── templates.ts            // Шаблоны
└── publishing.ts           // Публикация
```

### 7.3 База данных
- Расширение таблицы campaign_content
- Новые таблицы: story_slides, story_elements
- JSON поля для сложных конфигураций

## 8. Пользовательский опыт

### 8.1 Создание новой истории
1. Выбор шаблона или создание с нуля
2. Добавление слайдов
3. Настройка контента каждого слайда
4. Предварительный просмотр
5. Планирование публикации

### 8.2 Редактирование
- Автосохранение каждые 30 секунд
- История изменений (undo/redo)
- Быстрые клавиши для частых операций
- Предварительный просмотр в реальном времени

## 9. Этапы реализации

### Этап 1: Базовая структура
- Создание компонентов-заглушек
- API endpoints
- Структура БД

### Этап 2: Основной редактор
- Canvas с drag-and-drop
- Добавление текста и изображений
- Базовые операции со слайдами

### Этап 3: Расширенные функции
- Интерактивные элементы
- Шаблоны
- Анимации

### Этап 4: Интеграция и публикация
- Связь с Instagram API
- Планировщик публикаций
- Тестирование и оптимизация

---

**Статус**: Ожидает согласования для начала реализации